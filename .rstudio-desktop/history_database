1484653066105:width = 10, height = 6
1484653066106:)
1484653066106:}
1484653070072:generateRelativeData(campaign_summary, measure = measure, window_size = 5) %>%
1484653070073:.[relative_measure < 1.15] %>%
1484653070074:plotRelativeEvolution(
1484653070074:trendlines = T, measure = measure, time_var = 'send_day',
1484653070074:color = group_by,
1484653070075:prior_change_dates = F, sto_line = T, sto_text = T, text_position = 0.93) +
1484653070075:theme_bw(base_family = 'Times', base_size = 14) +
1484653070075:labs(x = 'campaign send day', y = 'uplift of STO open rate') +
1484653070076:ggtitle('Uplift of STO open rate compared to control group',
1484653070076:subtitle = 'measured on contacts receiving campaigns throughout the whole period') +
1484653070076:scale_y_continuous(labels = scales::percent_format()) +
1484653070077:theme(plot.title = element_text(face = 'bold'), text = element_text(family = 'Yanone Kaffeesatz Regular'))
1484653070406:myggsave('prezi_relative_open_rate.png')
1484653120726:myggsave <- function(plot_name) {
1484653120727:if (!dir.exists(file.path('figure', customer))) {
1484653120728:dir.create(file.path('figure', customer))
1484653120729:}
1484653120730:ggsave(
1484653120730:file.path('figure', customer, str_c(customer, Sys.Date(), plot_name, sep = '_')),
1484653120731:width = 10.67, height = 6
1484653120732:)
1484653120733:}
1484653122869:myggsave('prezi_relative_open_rate.png')
1484653294815:refetch <- TRUE
1484653295668:program_data <- getCampaignDataForCustomer(customer, program, refetch = refetch)
1484655232941:unique_contacts <- unique(program_data[, .(segment, contact_id)])
1484655233588:n_campaigns <- program_data[segment == 'sto', uniqueN(campaign_id)]
1484655233934:common_contacts <- program_data[, .N, by = .(segment, contact_id)] %>%
1484655233935:.[N == n_campaigns, .(segment, contact_id)]
1484655236040:if (customer == 'batiwiz') {
1484655236041:# append new programs
1484655236042:na_program_data <- getCampaignDataForCustomer(customer, 'NA-TD120', refetch = refetch)
1484655236042:a_program_data <- getCampaignDataForCustomer(customer, 'A-TD120', refetch = refetch)
1484655236043:common_dates <- as.Date(
1484655236043:intersect(
1484655236043:unique(a_program_data$send_day),
1484655236044:unique(na_program_data$send_day))
1484655236044:, origin = '1970-01-01'
1484655236044:)
1484655236045:a_filtered <- a_program_data[send_day %in% common_dates]
1484655236045:na_filtered <- na_program_data[send_day %in% common_dates]
1484655236045:program_data <- rbindlist(list(program_data, na_filtered, a_filtered))
1484655236046:}
1484658248542:unique_contactlist <- unique(program_data[, .(segment, contact_id)])
1484658249672:first_contactlist <- getListOfFirstSTOReceivers(program_data)
1484658250472:last_contactlist <- getListOfLastSTOReceivers(program_data)
1484658250641:stable_contactlist <- merge(first_contactlist, last_contactlist, by = c('contact_id', 'segment'))
1484658251130:contactlist <- stable_contactlist
1484658253171:all_data <- addPastData(customer, program, program_data, contactlist, refetch = FALSE) %>%
1484658253171:merge(contactlist, by = c('contact_id', 'segment'))
1484658279512:n_past_campaigns <- all_data[period == 'past', .N, by = .(segment, contact_id)]
1484658280091:n_past_campaigns %>% ggplot(aes(x = N)) +
1484658280092:geom_histogram(binwidth = 5) +
1484658280093:scale_x_continuous(breaks = seq(0,90,5))
1484658695173:past_campaign_num_limit <- quantile(n_past_campaigns$N, 0.1)
1484658695739:past_campaign_num_limit <- 66
1484658696778:all_data <- merge(
1484658696779:all_data,
1484658696780:n_past_campaigns[N >= past_campaign_num_limit, .(contact_id, segment)],
1484658696780:by = c('contact_id', 'segment')
1484658696780:)
1484658699496:saveRDS(all_data, file.path('data', str_c(customer, '_', program, '_all_data.rds')))
1484658796864:campaign_summary <- calculateCampaignSummary(all_data)
1484658856296:generateRelativeData(campaign_summary, measure = measure, window_size = 5) %>%
1484658856297:.[relative_measure < 1.15] %>%
1484658856298:plotRelativeEvolution(
1484658856298:trendlines = T, measure = measure, time_var = 'send_day',
1484658856299:color = group_by,
1484658856299:prior_change_dates = F, sto_line = T, sto_text = T, text_position = 0.93) +
1484658856299:theme_bw(base_family = 'Times', base_size = 14) +
1484658856300:labs(x = 'campaign send day', y = 'uplift of STO open rate') +
1484658856300:ggtitle('Uplift of STO open rate compared to control group',
1484658856300:subtitle = 'measured on contacts receiving campaigns throughout the whole period') +
1484658856301:scale_y_continuous(labels = scales::percent_format()) +
1484658856301:theme(plot.title = element_text(face = 'bold'), text = element_text(family = 'Yanone Kaffeesatz Regular'))
1484658885472:font_import()
1484658945244:fonts()
1484658961470:generateRelativeData(campaign_summary, measure = measure, window_size = 5) %>%
1484658961471:.[relative_measure < 1.15] %>%
1484658961472:plotRelativeEvolution(
1484658961472:trendlines = T, measure = measure, time_var = 'send_day',
1484658961472:color = group_by,
1484658961473:prior_change_dates = F, sto_line = T, sto_text = T, text_position = 0.93) +
1484658961473:theme_bw(base_family = 'Times', base_size = 14) +
1484658961473:labs(x = 'campaign send day', y = 'uplift of STO open rate') +
1484658961474:ggtitle('Uplift of STO open rate compared to control group',
1484658961474:subtitle = 'measured on contacts receiving campaigns throughout the whole period') +
1484658961474:scale_y_continuous(labels = scales::percent_format()) +
1484658961475:theme(plot.title = element_text(face = 'bold'), text = element_text(family = 'Canaro Medium'))
1484659000468:addSTOline <- function(start_date = NULL, sto_line = TRUE, sto_text = TRUE, prior_changes = TRUE, text_position = 0.8) {
1484659000470:plot_list <- list()
1484659000471:if (sto_line) {
1484659000472:date_df <- data.table(x = start_date, y = text_position)
1484659000472:plot_list <- list(
1484659000473:plot_list,
1484659000473:geom_vline(
1484659000474:data = date_df,
1484659000475:aes(xintercept = as.numeric(x)),
1484659000475:color = 'black', linetype = 'dashed'
1484659000476:)
1484659000476:)
1484659000477:if (sto_text) {
1484659000478:plot_list <- list(
1484659000478:plot_list,
1484659000479:geom_text(
1484659000479:data = data.frame(x = start_date, y = text_position),
1484659000480:aes(x, y, label = 'Start of STO', family = 'Canaro Medium'),
1484659000481:color = 'black', hjust = 1.1
1484659000482:)
1484659000482:)
1484659000483:}
1484659000483:}
1484659000483:if (prior_changes) {
1484659000484:plot_list <- list(
1484659000485:plot_list,
1484659000486:geom_vline(
1484659000486:data = data.table(date = as.numeric(as.Date(PRIOR_CHANGE_DATES))),
1484659000487:aes(xintercept = date),
1484659000488:color = 'black', linetype = 'dotted'
1484659000489:)
1484659000489:)
1484659000490:}
1484659000491:plot_list
1484659000492:}
1484659008671:generateRelativeData(campaign_summary, measure = measure, window_size = 5) %>%
1484659008672:.[relative_measure < 1.15] %>%
1484659008673:plotRelativeEvolution(
1484659008673:trendlines = T, measure = measure, time_var = 'send_day',
1484659008673:color = group_by,
1484659008674:prior_change_dates = F, sto_line = T, sto_text = T, text_position = 0.93) +
1484659008674:theme_bw(base_family = 'Times', base_size = 14) +
1484659008674:labs(x = 'campaign send day', y = 'uplift of STO open rate') +
1484659008675:ggtitle('Uplift of STO open rate compared to control group',
1484659008675:subtitle = 'measured on contacts receiving campaigns throughout the whole period') +
1484659008675:scale_y_continuous(labels = scales::percent_format()) +
1484659008676:theme(plot.title = element_text(face = 'bold'), text = element_text(family = 'Canaro Medium'))
1484659009066:myggsave('prezi_relative_open_rate.png')
1484659961443:packrat::restore(prompt = FALSE)
1484660000064:install.packages('emsmetricr')
1484660006816:install.packages('emsmetricr', type = 'source')
1484660029943:packrat::snapshot(prompt = FALSE)
1484667505134:source('global.R')
1484667534761:customer <- "batiwiz"
1484667534764:program <- "NA-TD120"
1484667542399:past_contact_dt <- getBanditNumbersForPast(customer, program)
1484668451952:fread('data/batiwiz_NA-TD120.csv')
1484668472306:fread('data/batiwiz_NA-TD120.csv')[913916]
1484671534920:dt <- data.table(x = c(1, 2, 3), a1 = c(T, F , T), a2 = c(T, F, F), a3 = c(T, T, T))
1484671535961:dt
1484671565088:dt[, Reduce(`+`, .SD), .SDcols = c('a1', 'a2', 'a3')]
1484671570595:dt[, y:= Reduce(`+`, .SD), .SDcols = c('a1', 'a2', 'a3')]
1484671576432:dt[, y := Reduce(`+`, .SD), .SDcols = c('a1', 'a2', 'a3')][]
1484671590779:dt[, y := Reduce(`+`, .SD), .SDcols = grep("a.", names(dt), value = T)][]
1484897761828:source('global.R')
1484897762887:customer <- 'batiwiz'
1484897762887:program <- 'TD120'
1484897768049:refetch <- F
1484897768981:program_data <- getCampaignDataForCustomer(customer, program, refetch = refetch)
1484897771709:unique_contacts <- unique(program_data[, .(segment, contact_id)])
1484897772033:n_campaigns <- program_data[segment == 'sto', uniqueN(campaign_id)]
1484897772105:common_contacts <- program_data[, .N, by = .(segment, contact_id)] %>%
1484897772106:.[N == n_campaigns, .(segment, contact_id)]
1484897772369:reportStatistics(
1484897772369:customer, program_data,
1484897772370:unique_contacts, common_contacts,
1484897772371:check_pairwise_common = FALSE
1484897772371:)
1484897783812:customer <- 'batiwiz'
1484897784437:program <- 'TD120'
1484897784989:all_data <- readAllData(customer, program)
1484898451289:all_data[, .N, by = send_day]
1484898480428:all_data[, .N, keyby = send_day]
1484899118352:all_data[segment == 'sto']
1484899137975:all_data[segment == 'past']
1484899142071:all_data[period == 'past']
1484899183704:all_data[campaign_id %in% c(1108991, 603561, 609085, 613914)]
1484899201116:all_data[campaign_id %in% c(1108991, 603561, 609085, 613914)] %>%
1484899201116:.[, .(n = .N), by = .(period, send_day, send_hour)]
1484899253840:all_data[campaign_id %in% c(1108991, 603030, 603561, 609085, 613914)] %>%
1484899253840:.[, .(n = .N), by = .(period, send_day, send_hour)]
1484899271253:all_data[campaign_id %in% c(1108991, 603030, 603561, 609085, 613914)] %>%
1484899271253:.[, .(n = .N), by = .(period, send_day, send_hour)] %>%
1484899271254:.[order(send_hour)]
1484899317240:all_data[campaign_id %in% c(1108991, 603030, 603561, 609085, 613914)] %>%
1484899317240:.[, .(n = .N), by = .(period, send_day, send_hour)] %>%
1484899317241:.[, .(period, send_hour, share = n/.N), by = period]
1484899329499:all_data[campaign_id %in% c(1108991, 603030, 603561, 609085, 613914)] %>%
1484899329499:.[, .(n = .N), by = .(period, send_day, send_hour)] %>%
1484899329501:.[, .(period, send_hour, share = n/sum(n)), by = period]
1484899345739:all_data[campaign_id %in% c(1108991, 603030, 603561, 609085, 613914)] %>%
1484899345739:.[, .(n = .N), by = .(period, send_hour)] %>%
1484899345740:.[, .(period, send_hour, share = n/sum(n)), by = period]
1484899376449:all_data[campaign_id %in% c(1108991, 603030, 603561, 609085, 613914)] %>%
1484899376450:.[, .(n = .N), by = .(period, send_hour)] %>%
1484899376451:.[, .(period, send_hour, share = n/sum(n)), by = period] %>%
1484899376451:ggplot(aes(x = send_hour, y = n)) +
1484899376452:geom_col()
1484899384106:all_data[campaign_id %in% c(1108991, 603030, 603561, 609085, 613914)] %>%
1484899384106:.[, .(n = .N), by = .(period, send_hour)] %>%
1484899384107:.[, .(period, send_hour, share = n/sum(n)), by = period] %>%
1484899384107:ggplot(aes(x = send_hour, y = share)) +
1484899384108:geom_col()
1484899394678:all_data[campaign_id %in% c(1108991, 603030, 603561, 609085, 613914)] %>%
1484899394678:.[, .(n = .N), by = .(period, send_hour)] %>%
1484899394679:.[, .(period, send_hour, share = n/sum(n)), by = period] %>%
1484899394679:ggplot(aes(x = send_hour, y = share, fill = period)) +
1484899394680:geom_col()
1484900189752:all_data <- readAllData('batiwiz', 'test')
1484900225312:all_data <- readAllData('batiwiz', 'TD120')
1484900347724:all_data %>%
1484900347724:.[, .(n = .N), by = .(period, send_hour)] %>%
1484900347725:.[, campaign_index := seq(1, .N), by = .(period, campaign_id)]
1484900370476:all_data %>%
1484900370477:.[, .(n = .N), by = .(period, campaign_id, send_hour)]
1484900397500:all_data %>%
1484900397501:.[, .(n = .N), by = .(period, campaign_id, send_hour)] %>%
1484900397502:.[, campaign_index := seq(1, .N), by = .(period, campaign_id)]
1484900404405:all_data %>%
1484900404406:.[, .(n = .N), by = .(period, campaign_id, send_hour)] %>%
1484900404407:.[, campaign_index := seq(1, .N), by = .(period, campaign_id)] %>% .[]
1484900405455:.[, .(period, send_hour, share = n/sum(n)), by = period] %>%
1484900405456:ggplot(aes(x = send_hour, y = share, fill = period)) +
1484900405457:geom_col()
1484900532822:?max()
1484900550209:max(1:30)
1484900552487:max(1:30, 5)
1484900672067:all_data %>%
1484900672067:.[, .(n = .N), by = .(period, campaign_id, send_hour)] %>%
1484900672068:.[, order(unique(campaign_id))] %>% .[]
1484900721155:last_10_campaigns <- getCampaignsForProgram('batiwiz', 'TD120')
1484900730183:last_10_campaigns
1484900751395:last_10_campaigns <- all_data[, .(period, campaign_id, send_day)] %>%
1484900751396:unique()
1484900756384:last_10_campaigns
1484900779272:last_10_campaigns[, .N, by=period]
1484900817679:last_10_campaigns <- all_data[, .(period, campaign_id, send_day)] %>%
1484900817680:unique() %>%
1484900817680:.[order(send_day), tail(.SD, 10), by = period]
1484900823234:last_10_campaigns
1484900856975:all_data %>%
1484900856975:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484900856976:.[, .(n = .N), by = .(period, send_hour)]
1484900878492:all_data %>%
1484900878493:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484900878494:.[, .(n = .N), by = .(period, send_hour)] %>%
1484900878494:.[, .(period, send_hour = floor(send_hour/2)*2, share = n/sum(n)), by = period]
1484900885807:all_data %>%
1484900885808:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484900885809:.[, .(n = .N), by = .(period, send_hour)] %>%
1484900885809:.[, .(period, send_hour = floor(send_hour/2)*2, share = n/sum(n)), by = period] %>%
1484900885809:ggplot(aes(x = send_hour, y = share, fill = period)) +
1484900885810:geom_col()
1484900908872:all_data %>%
1484900908873:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484900908874:.[, .(n = .N), by = .(period, send_hour)] %>%
1484900908874:.[, .(period, send_hour = floor(send_hour/2)*2, share = n/sum(n)), by = period] %>%
1484900908874:ggplot(aes(x = send_hour, y = share, fill = period)) +
1484900908874:geom_col(position = 'dodge')
1484900922689:all_data %>%
1484900922689:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484900922690:.[, .(n = .N), by = .(period, send_hour)] %>%
1484900922690:.[, .(period, send_hour = floor(send_hour/2)*2, share = n/sum(n)), by = period] %>%
1484900922691:ggplot(aes(x = send_hour, y = share, fill = period)) +
1484900922691:geom_col(position = 'identity')
1484900949297:all_data %>%
1484900949298:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484900949298:.[, .(n = .N), by = .(period, send_hour)]
1484900988597:all_data %>%
1484900988597:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id')
1484901029368:all_data %>%
1484901029368:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484901029369:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484901029370:.[, .(period, send_hour = floor(send_hour/2)*2, share = n/sum(n)), by = period] %>%
1484901029371:ggplot(aes(x = send_hour, y = share, fill = period)) +
1484901029371:geom_col(position = 'identity')
1484901093486:all_data %>%
1484901093487:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484901093488:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484901093488:.[, .(period, send_hour = floor(send_hour/2)*2, share = n/sum(n)), by = period] %>%
1484901093488:ggplot(aes(x = send_hour, y = share, fill = period)) +
1484901093489:geom_col(position = 'identity')
1484901094535:labs(y = 'number of sends', x = 'day') +
1484901094535:theme(legend.position = 'bottom') +
1484901094536:scale_fill_manual(
1484901094537:values = c('s1' = "#6984D1", 's2' = "#32D17E", 's3' = "#10A5A1")
1484901094537:)) +
1484901094537:scale_y_continuous(labels = scales::comma)
1484901130449:all_data %>%
1484901130450:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484901130451:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484901130451:.[, .(period, send_hour = floor(send_hour/2)*2, share = n/sum(n)), by = period] %>%
1484901130451:ggplot(aes(x = send_hour, y = share, fill = period)) +
1484901130452:geom_col(position = 'identity')
1484901131519:labs(y = 'number of sends', x = 'day') +
1484901131519:theme(legend.position = 'bottom') +
1484901131520:scale_fill_manual(values = c('past' = "#6984D1", 'sto' = "#32D17E")) +
1484901131520:scale_y_continuous(labels = scales::comma)
1484901152192:all_data %>%
1484901152193:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484901152194:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484901152195:.[, .(period, send_hour = floor(send_hour/2)*2, share = n/sum(n)), by = period] %>%
1484901152196:ggplot(aes(x = send_hour, y = share, fill = period)) +
1484901152197:geom_col(position = 'identity') +
1484901152197:labs(y = 'number of sends', x = 'day') +
1484901152197:theme(legend.position = 'bottom') +
1484901152198:scale_fill_manual(values = c('past' = "#6984D1", 'sto' = "#32D17E")) +
1484901152198:scale_y_continuous(labels = scales::comma)
1484901202224:all_data %>%
1484901202224:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484901202225:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484901202225:.[, .(period, send_hour = floor(send_hour/2)*2, share = n/sum(n)), by = period] %>%
1484901202226:ggplot(aes(x = send_hour, y = share, fill = period)) +
1484901202227:geom_col(position = 'identity') +
1484901202227:labs(y = 'share of sends', x = 'send hour') +
1484901202228:theme_bw(base_size = 14) +
1484901202228:theme(legend.position = 'bottom') +
1484901202228:scale_fill_manual(values = c('past' = "#6984D1", 'sto' = "#32D17E")) +
1484901202229:scale_y_continuous(labels = scales::percent)
1484901243991:all_data %>%
1484901243991:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484901243992:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484901243992:.[, .(period, send_hour = floor(send_hour/2)*2, share = n/sum(n)), by = period] %>%
1484901243993:ggplot(aes(x = send_hour, y = share, fill = period)) +
1484901243993:geom_col(position = 'identity') +
1484901243993:labs(y = 'share of sends', x = 'send hour') +
1484901243994:theme_bw(base_size = 14) +
1484901243994:theme(legend.position = 'bottom') +
1484901243994:scale_fill_manual(
1484901243995:guide = guide_legend(''),
1484901243995:values = c('past' = "#6984D1", 'sto' = "#32D17E")
1484901243996:) +
1484901243997:scale_y_continuous(labels = scales::percent)
1484901292226:all_data %>%
1484901292226:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484901292227:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484901292228:.[, .(period, send_hour = floor(send_hour/2)*2, share = n/sum(n)), by = period] %>%
1484901292228:ggplot(aes(x = send_hour, y = share, fill = period)) +
1484901292229:geom_col(position = 'identity') +
1484901292229:labs(y = 'share of sends', x = 'send hour') +
1484901292230:theme_bw(base_size = 14) +
1484901292230:theme(legend.position = 'bottom') +
1484901292231:scale_fill_manual(
1484901292232:guide = guide_legend(''),
1484901292233:labels = c('before', 'after'),
1484901292234:values = c('past' = "#6984D1", 'sto' = "#32D17E")
1484901292234:) +
1484901292235:scale_y_continuous(labels = scales::percent)
1484901309513:all_data %>%
1484901309514:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484901309515:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484901309516:.[, .(period, send_hour = floor(send_hour/2)*2, share = n/sum(n)), by = period] %>%
1484901309516:ggplot(aes(x = send_hour, y = share, fill = period), alpha = 0.5) +
1484901309517:geom_col(position = 'identity') +
1484901309518:labs(y = 'share of sends', x = 'send hour') +
1484901309519:theme_bw(base_size = 14) +
1484901309519:theme(legend.position = 'bottom') +
1484901309519:scale_fill_manual(
1484901309520:guide = guide_legend(''),
1484901309520:labels = c('before', 'after'),
1484901309521:values = c('past' = "#6984D1", 'sto' = "#32D17E")
1484901309521:) +
1484901309522:scale_y_continuous(labels = scales::percent)
1484901325144:all_data %>%
1484901325145:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484901325145:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484901325146:.[, .(period, send_hour = floor(send_hour/2)*2, share = n/sum(n)), by = period] %>%
1484901325146:ggplot(aes(x = send_hour, y = share, fill = period)) +
1484901325146:geom_col(position = 'identity', alpha = 0.5) +
1484901325147:labs(y = 'share of sends', x = 'send hour') +
1484901325147:theme_bw(base_size = 14) +
1484901325147:theme(legend.position = 'bottom') +
1484901325148:scale_fill_manual(
1484901325148:guide = guide_legend(''),
1484901325149:labels = c('before', 'after'),
1484901325150:values = c('past' = "#6984D1", 'sto' = "#32D17E")
1484901325151:) +
1484901325152:scale_y_continuous(labels = scales::percent)
1484901421953:all_data %>%
1484901421954:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484901421955:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484901421956:.[, .(period, send_hour = floor(send_hour/2)*2, share = n/sum(n)), by = period] %>%
1484901421957:ggplot(aes(x = send_hour, y = share, fill = period)) +
1484901421957:geom_col(position = position_dodge(width = 0.5), alpha = 0.5) +
1484901421957:labs(y = 'share of sends', x = 'send hour') +
1484901421958:theme_bw(base_size = 14) +
1484901421958:theme(legend.position = 'bottom') +
1484901421959:scale_fill_manual(
1484901421959:guide = guide_legend(''),
1484901421959:labels = c('before', 'after'),
1484901421960:values = c('past' = "#6984D1", 'sto' = "#32D17E")
1484901421960:) +
1484901421961:scale_y_continuous(labels = scales::percent)
1484901476279:all_data %>%
1484901476279:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484901476280:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484901476281:.[, .(period, send_hour = floor(send_hour/2)*2, share = n/sum(n)), by = period] %>%
1484901476281:ggplot(aes(x = send_hour, y = share, fill = period)) +
1484901476281:geom_col() +
1484901476282:facet_wrap(~ period) +
1484901476282:labs(y = 'share of sends', x = 'send hour') +
1484901476282:theme_bw(base_size = 14) +
1484901476283:theme(legend.position = 'bottom') +
1484901476283:scale_fill_manual(
1484901476283:values = c('past' = "#6984D1", 'sto' = "#32D17E")
1484901476284:) +
1484901476284:scale_y_continuous(labels = scales::percent)
1484901489628:all_data %>%
1484901489628:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484901489629:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484901489630:.[, .(period, send_hour = floor(send_hour/2)*2, share = n/sum(n)), by = period] %>%
1484901489630:ggplot(aes(x = send_hour, y = share, fill = period)) +
1484901489630:geom_col() +
1484901489631:facet_wrap(~ period) +
1484901489631:labs(y = 'share of sends', x = 'send hour') +
1484901489631:theme_bw(base_size = 14) +
1484901489632:theme(legend.position = 'bottom') +
1484901489632:scale_fill_manual(
1484901489632:guide = guide_legend(''),
1484901489633:labels = c('before', 'after'),
1484901489633:values = c('past' = "#6984D1", 'sto' = "#32D17E")
1484901489634:) +
1484901489634:scale_y_continuous(labels = scales::percent)
1484901502241:all_data %>%
1484901502243:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484901502243:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484901502244:.[, .(period, send_hour = floor(send_hour/2)*2, share = n/sum(n)), by = period] %>%
1484901502244:ggplot(aes(x = send_hour, y = share, fill = period)) +
1484901502244:geom_col() +
1484901502245:facet_wrap(~ period, ncol = 1) +
1484901502245:labs(y = 'share of sends', x = 'send hour') +
1484901502245:theme_bw(base_size = 14) +
1484901502246:theme(legend.position = 'bottom') +
1484901502246:scale_fill_manual(
1484901502246:guide = guide_legend(''),
1484901502247:labels = c('before', 'after'),
1484901502247:values = c('past' = "#6984D1", 'sto' = "#32D17E")
1484901502248:) +
1484901502248:scale_y_continuous(labels = scales::percent)
1484901577083:all_data %>%
1484901577084:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484901577084:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484901577085:.[, .(period, send_hour = floor(send_hour/2)*2, share = n/sum(n)), by = period] %>%
1484901577085:ggplot(aes(x = send_hour, y = share, fill = period)) +
1484901577085:geom_col() +
1484901577086:facet_wrap(~ period, ncol = 1) +
1484901577086:labs(y = 'share of sends', x = 'send hour') +
1484901577086:theme_bw(base_size = 14) +
1484901577087:theme(
1484901577087:legend.position = 'bottom',
1484901577087:strip.background = element_blank(),
1484901577088:strip.text.x = element_blank()
1484901577088:) +
1484901577089:scale_fill_manual(
1484901577089:guide = guide_legend(''),
1484901577089:labels = c('before', 'after'),
1484901577090:values = c('past' = "#6984D1", 'sto' = "#32D17E")
1484901577090:) +
1484901577090:scale_y_continuous(labels = scales::percent)
1484901597429:all_data %>%
1484901597429:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484901597430:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484901597430:.[, .(period, send_hour = floor(send_hour/2)*2, share = n/sum(n)), by = period] %>%
1484901597431:ggplot(aes(x = send_hour, y = share, fill = period)) +
1484901597431:geom_col() +
1484901597431:facet_wrap(~ period, ncol = 1) +
1484901597432:labs(y = 'share of sends', x = 'send hour') +
1484901597432:theme_bw(base_size = 14) +
1484901597432:theme(
1484901597433:legend.position = 'bottom',
1484901597433:strip.background = element_blank(),
1484901597433:strip.text.x = element_blank()
1484901597434:) +
1484901597434:scale_fill_manual(
1484901597435:guide = guide_legend(''),
1484901597435:labels = c('before', 'after'),
1484901597436:values = c('past' = "#6984D1", 'sto' = "#32D17E")
1484901597436:) +
1484901597436:scale_y_continuous(labels = scales::percent) +
1484901597437:scale_x_continuous(breaks = seq(0, 22, 2))
1484901648724:all_data %>%
1484901648724:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484901648725:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484901648726:.[, .(period, send_hour = floor(send_hour/2)*2, share = n/sum(n)), by = period] %>%
1484901648726:ggplot(aes(x = send_hour, y = share, fill = period)) +
1484901648726:geom_col() +
1484901648727:facet_wrap(~ period, ncol = 1) +
1484901648727:scale_y_continuous(labels = scales::percent) +
1484901648727:scale_x_continuous(breaks = seq(0, 22, 2)) +
1484901648728:labs(y = 'share of sends', x = 'send hour') +
1484901648728:theme_bw(base_size = 14) +
1484901648728:theme(
1484901648729:legend.position = 'bottom',
1484901648730:strip.background = element_blank(),
1484901648731:strip.text.x = element_blank()
1484901648731:) +
1484901648732:scale_fill_manual(
1484901648732:guide = guide_legend(''),
1484901648732:labels = c('before', 'after'),
1484901648733:values = c('past' = "#32D17E", 'sto' = "#6984D1")
1484901648733:)
1484901660135:all_data %>%
1484901660136:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484901660137:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484901660137:.[, .(period, send_hour = floor(send_hour/2)*2, share = n/sum(n)), by = period] %>%
1484901660137:ggplot(aes(x = send_hour, y = share, fill = period)) +
1484901660138:geom_col() +
1484901660138:facet_wrap(~ period, ncol = 1) +
1484901660139:scale_y_continuous(labels = scales::percent) +
1484901660139:scale_x_continuous(breaks = seq(0, 22, 2)) +
1484901660139:labs(y = 'share of sends', x = 'send hour') +
1484901660140:theme_bw(base_size = 14) +
1484901660140:theme(
1484901660140:legend.position = 'bottom',
1484901660141:strip.background = element_blank(),
1484901660141:strip.text.x = element_blank()
1484901660141:) +
1484901660142:scale_fill_manual(
1484901660142:guide = guide_legend(''),
1484901660142:labels = c('before', 'after'),
1484901660143:values = c('past' = "#6984D1", 'sto' = "#32D17E")
1484901660143:)
1484901705043:all_data %>%
1484901705044:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484901705044:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484901705045:.[, .(period, send_hour = floor(send_hour/2)*2, share = n/sum(n)), by = period] %>%
1484901705045:ggplot(aes(x = send_hour, y = share, fill = period)) +
1484901705045:geom_col() +
1484901705046:facet_wrap(~ period, ncol = 1) +
1484901705046:scale_y_continuous(labels = scales::percent) +
1484901705046:scale_x_continuous(breaks = seq(0, 22, 2)) +
1484901705047:labs(y = 'share of sends', x = 'send hour') +
1484901705047:theme_bw(base_size = 14) +
1484901705048:theme(
1484901705049:legend.position = 'bottom',
1484901705050:strip.background = element_blank(),
1484901705050:sstrip.text.x = element_blank(),
1484901705051:text = element_text(family = 'Canaro Medium')
1484901705052:) +
1484901705052:scale_fill_manual(
1484901705052:guide = guide_legend(''),
1484901705053:labels = c('before', 'after'),
1484901705053:values = c('past' = "#6984D1", 'sto' = "#32D17E")
1484901705054:)
1484901713178:all_data %>%
1484901713179:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484901713180:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484901713180:.[, .(period, send_hour = floor(send_hour/2)*2, share = n/sum(n)), by = period] %>%
1484901713180:ggplot(aes(x = send_hour, y = share, fill = period)) +
1484901713181:geom_col() +
1484901713181:facet_wrap(~ period, ncol = 1) +
1484901713182:scale_y_continuous(labels = scales::percent) +
1484901713183:scale_x_continuous(breaks = seq(0, 22, 2)) +
1484901713183:labs(y = 'share of sends', x = 'send hour') +
1484901713184:theme_bw(base_size = 14) +
1484901713185:theme(
1484901713186:legend.position = 'bottom',
1484901713186:strip.background = element_blank(),
1484901713186:strip.text.x = element_blank(),
1484901713187:text = element_text(family = 'Canaro Medium')
1484901713187:) +
1484901713188:scale_fill_manual(
1484901713188:guide = guide_legend(''),
1484901713188:labels = c('before', 'after'),
1484901713189:values = c('past' = "#6984D1", 'sto' = "#32D17E")
1484901713190:)
1484901767270:all_data %>%
1484901767270:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484901767271:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484901767271:.[, .(period, send_hour = floor(send_hour/2)*2, share = n/sum(n)), by = period] %>%
1484901767271:ggplot(aes(x = send_hour, y = share, fill = period)) +
1484901767272:geom_col() +
1484901767272:facet_wrap(~ period, ncol = 1) +
1484901767272:scale_y_continuous(labels = scales::percent) +
1484901767273:scale_x_continuous(breaks = seq(0, 22, 2)) +
1484901767273:labs(y = 'share of sends', x = 'send hour') +
1484901767273:theme_bw(base_size = 14) +
1484901767274:theme(
1484901767274:legend.position = 'bottom',
1484901767274:text = element_text(family = 'Canaro Medium')
1484901767275:) +
1484901767275:scale_fill_manual(
1484901767276:guide = FALSE
1484901767276:values = c('past' = "#6984D1", 'sto' = "#32D17E")
1484901767276:)
1484901773131:all_data %>%
1484901773131:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484901773132:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484901773133:.[, .(period, send_hour = floor(send_hour/2)*2, share = n/sum(n)), by = period] %>%
1484901773133:ggplot(aes(x = send_hour, y = share, fill = period)) +
1484901773134:geom_col() +
1484901773135:facet_wrap(~ period, ncol = 1) +
1484901773136:scale_y_continuous(labels = scales::percent) +
1484901773137:scale_x_continuous(breaks = seq(0, 22, 2)) +
1484901773138:labs(y = 'share of sends', x = 'send hour') +
1484901773138:theme_bw(base_size = 14) +
1484901773139:theme(
1484901773139:legend.position = 'bottom',
1484901773139:text = element_text(family = 'Canaro Medium')
1484901773140:) +
1484901773140:scale_fill_manual(
1484901773141:guide = FALSE,
1484901773141:values = c('past' = "#6984D1", 'sto' = "#32D17E")
1484901773142:)
1484901814167:all_data %>%
1484901814168:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484901814169:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484901814169:.[, .(
1484901814170:period = ifelse(period == 'past', 'before', 'after'),
1484901814171:send_hour = floor(send_hour/2)*2,
1484901814172:share = n/sum(n)
1484901814172:), by = period
1484901814173:] %>%
1484901814173:ggplot(aes(x = send_hour, y = share, fill = period)) +
1484901814174:geom_col() +
1484901814174:facet_wrap(~ period, ncol = 1) +
1484901814175:scale_y_continuous(labels = scales::percent) +
1484901814175:scale_x_continuous(breaks = seq(0, 22, 2)) +
1484901814175:labs(y = 'share of sends', x = 'send hour') +
1484901814176:theme_bw(base_size = 14) +
1484901814176:theme(
1484901814177:legend.position = 'bottom',
1484901814177:text = element_text(family = 'Canaro Medium')
1484901814178:) +
1484901814178:scale_fill_manual(
1484901814178:guide = FALSE,
1484901814179:values = c('past' = "#6984D1", 'sto' = "#32D17E")
1484901814180:)
1484901824821:all_data %>%
1484901824821:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484901824822:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484901824822:.[, .(
1484901824823:period = ifelse(period == 'past', 'before', 'after'),
1484901824823:send_hour = floor(send_hour/2)*2,
1484901824823:share = n/sum(n)
1484901824824:), by = period
1484901824824:]
1484901868217:all_data %>%
1484901868218:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484901868218:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484901868219:.[, .(
1484901868219:before_after = ifelse(period == 'past', 'before', 'after'),
1484901868219:send_hour = floor(send_hour/2)*2,
1484901868220:share = n/sum(n)
1484901868220:), by = period
1484901868220:] %>%
1484901868221:ggplot(aes(x = send_hour, y = share, fill = before_after)) +
1484901868221:geom_col() +
1484901868222:facet_wrap(~ before_after, ncol = 1) +
1484901868223:scale_y_continuous(labels = scales::percent) +
1484901868223:scale_x_continuous(breaks = seq(0, 22, 2)) +
1484901868224:labs(y = 'share of sends', x = 'send hour') +
1484901868225:theme_bw(base_size = 14) +
1484901868226:theme(
1484901868226:legend.position = 'bottom',
1484901868227:text = element_text(family = 'Canaro Medium')
1484901868227:) +
1484901868228:scale_fill_manual(
1484901868229:guide = FALSE,
1484901868230:values = c('past' = "#6984D1", 'sto' = "#32D17E")
1484901868230:)
1484901894585:all_data %>%
1484901894586:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484901894587:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484901894587:.[, .(
1484901894587:before_after = ifelse(period == 'past', 'Before', 'After'),
1484901894588:send_hour = floor(send_hour/2)*2,
1484901894588:share = n/sum(n)
1484901894588:), by = period
1484901894589:] %>%
1484901894590:ggplot(aes(x = send_hour, y = share, fill = before_after)) +
1484901894591:geom_col() +
1484901894591:facet_wrap(~ before_after, ncol = 1) +
1484901894592:scale_y_continuous(labels = scales::percent) +
1484901894593:scale_x_continuous(breaks = seq(0, 22, 2)) +
1484901894594:labs(y = 'Share of sends', x = 'Send hour') +
1484901894594:theme_bw(base_size = 14) +
1484901894595:theme(
1484901894595:legend.position = 'bottom',
1484901894596:text = element_text(family = 'Canaro Medium')
1484901894597:) +
1484901894597:scale_fill_manual(
1484901894598:guide = FALSE,
1484901894599:values = c('past' = "#6984D1", 'sto' = "#32D17E")
1484901894600:)
1484901901738:all_data %>%
1484901901739:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484901901740:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484901901741:.[, .(
1484901901741:before_after = ifelse(period == 'past', 'Before', 'After'),
1484901901742:send_hour = floor(send_hour/2)*2,
1484901901743:share = n/sum(n)
1484901901743:), by = period
1484901901744:]
1484901921545:all_data %>%
1484901921545:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484901921546:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484901921547:.[, .(
1484901921547:before_after = ifelse(period == 'past', 'Before', 'After'),
1484901921547:send_hour = floor(send_hour/2)*2,
1484901921548:share = n/sum(n)
1484901921548:), by = period
1484901921548:] %>%
1484901921549:ggplot(aes(x = send_hour, y = share, fill = before_after))
1484901969155:all_data %>%
1484901969155:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484901969156:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484901969156:.[, .(
1484901969156:send_hour = floor(send_hour/2)*2,
1484901969157:share = n/sum(n)
1484901969157:), by = period
1484901969158:] %>%
1484901969158:.[, period := ifelse(period == 'past', 'Before', 'After')]
1484901996149:all_data %>%
1484901996150:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484901996151:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484901996151:.[, .(
1484901996151:before_after = ifelse(period == 'past', 'Before', 'After'),
1484901996152:send_hour = floor(send_hour/2)*2,
1484901996152:share = n/sum(n)
1484901996152:), by = period
1484901996153:] %>%
1484901996153:ggplot(aes(x = send_hour, y = share, fill = before_after)) +
1484901996153:geom_col() +
1484901996154:facet_wrap(~ before_after, ncol = 1) +
1484901996154:scale_y_continuous(labels = scales::percent) +
1484901996154:scale_x_continuous(breaks = seq(0, 22, 2)) +
1484901996155:labs(y = 'Share of sends', x = 'Send hour') +
1484901996155:theme_bw(base_size = 14) +
1484901996155:theme(
1484901996156:legend.position = 'bottom',
1484901996156:text = element_text(family = 'Canaro Medium')
1484901996157:) +
1484901996157:scale_fill_manual(
1484901996157:guide = FALSE,
1484901996158:values = c('before' = "#6984D1", 'after' = "#32D17E")
1484901996158:)
1484902014127:all_data %>%
1484902014127:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484902014129:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484902014129:.[, .(
1484902014130:before_after = ifelse(period == 'past', 'Before', 'After'),
1484902014130:send_hour = floor(send_hour/2)*2,
1484902014131:share = n/sum(n)
1484902014132:), by = period
1484902014132:]
1484902028339:all_data %>%
1484902028340:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484902028341:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484902028341:.[, .(
1484902028341:before_after = ifelse(period == 'past', 'Before', 'After'),
1484902028342:send_hour = floor(send_hour/2)*2,
1484902028342:share = n/sum(n)
1484902028342:), by = period
1484902028343:] %>%
1484902028343:ggplot(aes(x = send_hour, y = share, fill = before_after))
1484902034638:all_data %>%
1484902034639:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484902034640:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484902034640:.[, .(
1484902034640:before_after = ifelse(period == 'past', 'Before', 'After'),
1484902034641:send_hour = floor(send_hour/2)*2,
1484902034641:share = n/sum(n)
1484902034641:), by = period
1484902034641:] %>%
1484902034642:ggplot(aes(x = send_hour, y = share, fill = period))
1484902049830:all_data %>%
1484902049830:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484902049831:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484902049832:.[, .(
1484902049832:before_after = ifelse(period == 'past', 'Before', 'After'),
1484902049833:send_hour = floor(send_hour/2)*2,
1484902049833:share = n/sum(n)
1484902049833:), by = period
1484902049833:] %>%
1484902049834:ggplot(aes(x = send_hour, y = share))
1484902057327:all_data %>%
1484902057328:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484902057329:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484902057329:.[, .(
1484902057331:before_after = ifelse(period == 'past', 'Before', 'After'),
1484902057332:send_hour = floor(send_hour/2)*2,
1484902057333:share = n/sum(n)
1484902057333:), by = period
1484902057334:]
1484902106570:all_data %>%
1484902106570:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484902106571:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484902106572:.[, .(
1484902106572:send_hour = floor(send_hour/2)*2,
1484902106572:share = n/sum(n)
1484902106573:), by = period
1484902106573:] %>%
1484902106573:.[, period := ifelse(period == 'past', 'Before', 'After')] %>%
1484902106574:ggplot(aes(x = send_hour, y = share, fill = period)) +
1484902106574:geom_col() +
1484902106574:facet_wrap(~ period, ncol = 1) +
1484902106575:scale_y_continuous(labels = scales::percent) +
1484902106575:scale_x_continuous(breaks = seq(0, 22, 2)) +
1484902106575:labs(y = 'Share of sends', x = 'Send hour') +
1484902106576:theme_bw(base_size = 14) +
1484902106576:theme(
1484902106576:legend.position = 'bottom',
1484902106577:text = element_text(family = 'Canaro Medium')
1484902106577:) +
1484902106577:scale_fill_manual(
1484902106578:guide = FALSE,
1484902106578:values = c('before' = "#6984D1", 'after' = "#32D17E")
1484902106579:)
1484902118362:all_data %>%
1484902118363:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484902118364:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484902118364:.[, .(
1484902118364:send_hour = floor(send_hour/2)*2,
1484902118365:share = n/sum(n)
1484902118365:), by = period
1484902118366:] %>%
1484902118366:.[, period := ifelse(period == 'past', 'Before', 'After')] %>% .[]
1484902132376:all_data %>%
1484902132376:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484902132377:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484902132377:.[, .(
1484902132377:send_hour = floor(send_hour/2)*2,
1484902132378:share = n/sum(n)
1484902132378:), by = period
1484902132378:] %>%
1484902132379:.[, period := ifelse(period == 'past', 'Before', 'After')] %>% .[] %>%
1484902132379:ggplot(aes(x = send_hour, y = share, fill = period))
1484902155113:all_data %>%
1484902155114:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484902155115:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484902155115:.[, .(
1484902155115:send_hour = floor(send_hour/2)*2,
1484902155115:share = n/sum(n)
1484902155116:), by = period
1484902155116:] %>%
1484902155117:# .[, period := ifelse(period == 'past', 'Before', 'After')] %>% .[] %>%
1484902155117:ggplot(aes(x = send_hour, y = share, fill = period))
1484902184059:all_data %>%
1484902184059:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484902184060:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484902184061:.[, .(
1484902184061:send_hour = floor(send_hour/2)*2,
1484902184061:share = n/sum(n)
1484902184061:), by = period
1484902184062:] %>%
1484902184062:.[, period := ifelse(period == 'past', 'Before', 'After')] %>%
1484902184062:ggplot(aes(x = send_hour, y = share, fill = period)) +
1484902184063:geom_col()
1484902190196:all_data %>%
1484902190197:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484902190198:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484902190198:.[, .(
1484902190198:send_hour = floor(send_hour/2)*2,
1484902190199:share = n/sum(n)
1484902190199:), by = period
1484902190199:] %>%
1484902190199:.[, period := ifelse(period == 'past', 'Before', 'After')] %>%
1484902190200:ggplot(aes(x = send_hour, y = share, fill = period)) +
1484902190200:geom_col() +
1484902190201:facet_wrap(~ period, ncol = 1) +
1484902190201:scale_y_continuous(labels = scales::percent) +
1484902190201:scale_x_continuous(breaks = seq(0, 22, 2)) +
1484902190202:labs(y = 'Share of sends', x = 'Send hour') +
1484902190203:theme_bw(base_size = 14) +
1484902190204:theme(
1484902190205:legend.position = 'bottom',
1484902190206:text = element_text(family = 'Canaro Medium')
1484902190206:) +
1484902190207:scale_fill_manual(
1484902190207:guide = FALSE,
1484902190208:values = c('before' = "#6984D1", 'after' = "#32D17E")
1484902190209:)
1484902211741:all_data %>%
1484902211741:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484902211742:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484902211742:.[, .(
1484902211743:before_after = ifelse(period == 'past', 'Before', 'After'),
1484902211743:send_hour = floor(send_hour/2)*2,
1484902211743:share = n/sum(n)
1484902211744:), by = period
1484902211744:] %>%
1484902211744:ggplot(aes(x = send_hour, y = share, fill = before_after)) +
1484902211745:geom_col()
1484902228589:all_data %>%
1484902228590:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484902228591:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484902228591:.[, .(
1484902228591:before_after = ifelse(period == 'past', 'Before', 'After'),
1484902228592:send_hour = floor(send_hour/2)*2,
1484902228592:share = n/sum(n)
1484902228592:), by = period
1484902228593:] %>%
1484902228593:ggplot(aes(x = send_hour, y = share, fill = before_after)) +
1484902228593:geom_col() +
1484902228594:facet_wrap(~ before_after, ncol = 1) +
1484902228594:scale_y_continuous(labels = scales::percent) +
1484902228595:scale_x_continuous(breaks = seq(0, 22, 2)) +
1484902228595:labs(y = 'Share of sends', x = 'Send hour') +
1484902228595:theme_bw(base_size = 14) +
1484902228596:theme(
1484902228596:legend.position = 'bottom',
1484902228597:text = element_text(family = 'Canaro Medium')
1484902228597:) +
1484902228597:scale_fill_manual(
1484902228598:guide = FALSE,
1484902228598:values = c('Before' = "#6984D1", 'After' = "#32D17E")
1484902228599:)
1484902266999:ggsave('figure/webinar/send_time_distribution.png')
1484902319482:all_data %>%
1484902319483:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484902319484:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484902319484:.[, .(
1484902319484:before_after = ifelse(period == 'past', 'Before', 'After'),
1484902319485:send_hour = floor(send_hour/2)*2,
1484902319485:share = n/sum(n)
1484902319485:), by = period
1484902319486:] %>%
1484902319486:ggplot(aes(x = send_hour, y = share, fill = before_after)) +
1484902319486:geom_col() +
1484902319487:facet_wrap(~ before_after, ncol = 1, scales = 'free_y') +
1484902319487:scale_y_continuous(labels = scales::percent) +
1484902319488:scale_x_continuous(breaks = seq(0, 22, 2)) +
1484902319488:labs(y = 'Share of sends', x = 'Send hour') +
1484902319488:theme_bw(base_size = 14) +
1484902319489:theme(
1484902319489:legend.position = 'bottom',
1484902319490:text = element_text(family = 'Canaro Medium')
1484902319491:) +
1484902319492:scale_fill_manual(
1484902319493:guide = FALSE,
1484902319494:values = c('Before' = "#6984D1", 'After' = "#32D17E")
1484902319494:)
1484902417371:?ordered
1484902438080:all_data %>%
1484902438080:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484902438081:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484902438081:.[, .(
1484902438082:before_after = ordered(ifelse(period == 'past', 'Before', 'After'), levels = c('Before', 'After')),
1484902438082:send_hour = floor(send_hour/2)*2,
1484902438082:share = n/sum(n)
1484902438083:), by = period
1484902438083:] %>%
1484902438083:ggplot(aes(x = send_hour, y = share, fill = before_after)) +
1484902438084:geom_col() +
1484902438084:facet_wrap(~ before_after, ncol = 1, scales = 'free_y') +
1484902438084:scale_y_continuous(labels = scales::percent) +
1484902438085:scale_x_continuous(breaks = seq(0, 22, 2)) +
1484902438085:labs(y = 'Share of sends', x = 'Send hour') +
1484902438085:theme_bw(base_size = 14) +
1484902438086:theme(
1484902438086:legend.position = 'bottom',
1484902438087:text = element_text(family = 'Canaro Medium')
1484902438087:) +
1484902438087:scale_fill_manual(
1484902438088:guide = FALSE,
1484902438088:values = c('Before' = "#6984D1", 'After' = "#32D17E")
1484902438089:)
1484902482313:all_data %>%
1484902482313:merge(last_10_campaigns[, .(campaign_id)], by = 'campaign_id') %>%
1484902482314:.[segment == 'sto', .(n = .N), by = .(period, send_hour)] %>%
1484902482315:.[, .(
1484902482316:before_after = ordered(ifelse(period == 'past', 'Before', 'After'), levels = c('Before', 'After')),
1484902482317:send_hour = floor(send_hour/2)*2,
1484902482318:share = n/sum(n)
1484902482318:), by = period
1484902482319:] %>%
1484902482319:ggplot(aes(x = send_hour, y = share, fill = before_after)) +
1484902482319:geom_col() +
1484902482320:facet_wrap(~ before_after, nrow = 1, scales = 'free_y') +
1484902482320:scale_y_continuous(labels = scales::percent) +
1484902482320:scale_x_continuous(breaks = seq(0, 22, 2)) +
1484902482321:labs(y = 'Share of sends', x = 'Send hour') +
1484902482321:theme_bw(base_size = 14) +
1484902482322:theme(
1484902482322:legend.position = 'bottom',
1484902482323:text = element_text(family = 'Canaro Medium')
1484902482324:) +
1484902482325:scale_fill_manual(
1484902482325:guide = FALSE,
1484902482326:values = c('Before' = "#6984D1", 'After' = "#32D17E")
1484902482326:)
1484902532642:ggsave('figure/webinar/send_time_distribution.png', width = 8, height = 6)
1484902581353:ggsave('figure/webinar/send_time_distribution.png', width = 10.67, height = 6)
1484903280879:customer <- 'lesara'
1484903281476:program <- 'NL_male'
1484903297578:refetch <- TRUE
1484903303745:program_data <- getCampaignDataForCustomer(customer, program, refetch = refetch)
1484903351648:getCampaignsForProgram(customer, program, refetch = refetch)
1484905519381:customer <- 'lesara'
1484905519871:program <- 'NL_male'
1484905524456:program_data <- getCampaignDataForCustomer(customer, program, refetch = refetch)
1484905537756:campaigns <- getCampaignsForProgram(customer, program, refetch = refetch) %>%
1484905537756:convertSendDayToDate()
1484905568135:getCampaignsForProgram(customer, program, refetch = refetch)
1484905584309:program_properties <- SETTINGS[[customer]]$programs[[program]]
1484905588400:program_properties
1484905615418:source('global.R')
1484905617474:program_properties <- SETTINGS[[customer]]$programs[[program]]
1484905619458:program_properties
1484905629614:program_data <- getCampaignDataForCustomer(customer, program, refetch = refetch)
1484905649250:program_data
1484905654382:program_data[, .N, by = campaign_id]
1484905729525:program_data[, .N, by = .(campaign_id, send_day, segment)]
1484906161128:source('global.R')
1484906188274:getCampaignsForProgram('lesra', 'test')
1484906291832:unique_contacts <- unique(program_data[, .(segment, contact_id)])
1484906293127:n_campaigns <- program_data[segment == 'sto', uniqueN(campaign_id)]
1484906294090:common_contacts <- program_data[, .N, by = .(segment, contact_id)] %>%
1484906294091:.[N == n_campaigns, .(segment, contact_id)]
1484906295281:reportStatistics(
1484906295282:customer, program_data,
1484906295283:unique_contacts, common_contacts,
1484906295283:check_pairwise_common = FALSE
1484906295283:)
1484906309919:unique_contactlist <- unique(program_data[, .(segment, contact_id)])
1484906310219:first_contactlist <- getListOfFirstSTOReceivers(program_data)
1484906310524:last_contactlist <- getListOfLastSTOReceivers(program_data)
1484906310962:stable_contactlist <- merge(first_contactlist, last_contactlist, by = c('contact_id', 'segment'))
1484906349313:contactlist <- unique_contactlist
1484906354382:all_data <- addPastData(customer, program, program_data, contactlist, refetch = FALSE) %>%
1484906354383:merge(contactlist, by = c('contact_id', 'segment'))
1484906499088:n_past_campaigns <- all_data[period == 'past', .N, by = .(segment, contact_id)]
1484906500350:n_past_campaigns %>% ggplot(aes(x = N)) +
1484906500350:geom_histogram(binwidth = 5) +
1484906500352:scale_x_continuous(breaks = seq(0,90,5))
1484906518817:past_campaign_num_limit <- quantile(n_past_campaigns$N, 0.1)
1484906561373:group_by <- NULL
1484906563317:all_data %>% .[, .(number_of_emails = .N), by = .(send_day, period, segment)] %>%
1484906563317:plotEvolution(measure = 'number_of_emails', se = FALSE)
1484906611573:contactlist <- first_contactlist
1484906617662:all_data <- addPastData(customer, program, program_data, contactlist, refetch = FALSE) %>%
1484906617662:merge(contactlist, by = c('contact_id', 'segment'))
1484906625462:n_past_campaigns <- all_data[period == 'past', .N, by = .(segment, contact_id)]
1484906626367:n_past_campaigns %>% ggplot(aes(x = N)) +
1484906626368:geom_histogram(binwidth = 5) +
1484906626369:scale_x_continuous(breaks = seq(0,90,5))
1484906632696:all_data %>% .[, .(number_of_emails = .N), by = .(send_day, period, segment)] %>%
1484906632699:plotEvolution(measure = 'number_of_emails', se = FALSE)
1484906638257:all_data %>% getRecipientShareForContactlist(contactlist) %>%
1484906638258:plotEvolution(measure = 'recipient_share', se = FALSE)
1484906667305:all_data %>% getRecipientShareForContactlist(contactlist, unique = TRUE) %>%
1484906667305:plotEvolution(measure = 'recipient_share', se = FALSE)
1484906745920:all_data[period == 'sto', min(send_day)]
1484906766099:all_data[period == 'sto' & segment == 'sto', min(send_day)]
1484906834328:min(program_data$send_day)
1484906983815:getListOfFirstSTOReceivers <- function(program_data) {
1484906983816:start_date <- min(program_data$send_day)
1484906983816:program_data %>%
1484906983817:.[send_day == start_date, .(contact_id, segment)] %>%
1484906983817:unique()
1484906983817:}
1484906983818:getListOfLastSTOReceivers <- function(program_data) {
1484906983818:end_date <- max(program_data$send_day)
1484906983819:program_data %>%
1484906983819:.[send_day == end_date, .(contact_id, segment)] %>%
1484906983819:unique()
1484906983820:}
1484906990005:first_contactlist <- getListOfFirstSTOReceivers(program_data)
1484906990730:last_contactlist <- getListOfLastSTOReceivers(program_data)
1484906992380:contactlist <- first_contactlist
1484906993478:all_data <- addPastData(customer, program, program_data, contactlist, refetch = FALSE) %>%
1484906993479:merge(contactlist, by = c('contact_id', 'segment'))
1484907005965:all_data <- readAllData(customer, program)
1484907009545:all_data %>% .[, .(number_of_emails = .N), by = .(send_day, period, segment)] %>%
1484907009546:plotEvolution(measure = 'number_of_emails', se = FALSE)
1484907013143:all_data %>% getRecipientShareForContactlist(contactlist) %>%
1484907013144:plotEvolution(measure = 'recipient_share', se = FALSE)
1484907014384:all_data %>% getRecipientShareForContactlist(contactlist, unique = TRUE) %>%
1484907014384:plotEvolution(measure = 'recipient_share', se = FALSE)
1484907044348:plotSendTimeDistributionEvolution(all_data[period == 'sto' & segment == 'sto'])
1484907076659:campaign_summary <- calculateCampaignSummary(all_data)
1484907079611:measure <- 'open_rate'
1484907081155:campaign_summary %>%
1484907081156:smoothMeasureWithWindow(measure, window_size = 1) %>%
1484907081157:plotEvolution(measure = measure) +
1484907081157:scale_y_continuous(labels = scales::percent_format())
1484907130156:generateRelativeData(campaign_summary, measure = measure) %>%
1484907130157:plotRelativeEvolution(
1484907130158:trendlines = F, measure = measure, color = group_by, text_position = 0.9
1484907130159:) +
1484907130159:coord_cartesian(ylim = c(0.9, 1.2))
1484907176589:contactlist <- unique_contactlist
1484907178000:all_data <- addPastData(customer, program, program_data, contactlist, refetch = FALSE) %>%
1484907178001:merge(contactlist, by = c('contact_id', 'segment'))
1484907185815:generateRelativeData(campaign_summary, measure = measure) %>%
1484907185816:plotRelativeEvolution(
1484907185817:trendlines = F, measure = measure, color = group_by, text_position = 0.9
1484907185817:) +
1484907185817:coord_cartesian(ylim = c(0.9, 1.2))
1484907214414:campaign_summary <- calculateCampaignSummary(all_data)
1484907219386:generateRelativeData(campaign_summary, measure = measure) %>%
1484907219386:plotRelativeEvolution(
1484907219387:trendlines = F, measure = measure, color = group_by, text_position = 0.9
1484907219388:) +
1484907219389:coord_cartesian(ylim = c(0.9, 1.2))
1484907239119:campaign_summary
1484907254884:campaign_summary[period == 'sto', .(campaign_id, open_rate)]
1484907260138:campaign_summary[period == 'sto', .(send_day, open_rate)]
1484907267382:campaign_summary[period == 'sto', .(send_day, segment, open_rate)]
1484907319186:names(campaign_summary)
1484907537642:head(all_data)
1484907592648:all_data[, .N, by = period]
1484907600485:all_data[period == "sto"]
1484908129692:all_data[period == "sto"][, .(sum(opened) / (.N - sum(bounced)))]
1484908363982:paste0(c("NL", "FR"), c("male", "female"))
1484908740881:if (customer == 'batiwiz') {
1484908740881:# append new programs
1484908740882:na_program_data <- getCampaignDataForCustomer(customer, 'NA-TD120', refetch = refetch)
1484908740883:a_program_data <- getCampaignDataForCustomer(customer, 'A-TD120', refetch = refetch)
1484908740883:common_dates <- as.Date(
1484908740883:intersect(
1484908740883:unique(a_program_data$send_day),
1484908740884:unique(na_program_data$send_day))
1484908740884:, origin = '1970-01-01'
1484908740884:)
1484908740885:a_filtered <- a_program_data[send_day %in% common_dates]
1484908740885:na_filtered <- na_program_data[send_day %in% common_dates]
1484908740886:program_data <- rbindlist(list(program_data, na_filtered, a_filtered))
1484908740886:} else if (customer == "lesara") {
1484908740887:vec_all_programs <- c("NL_male", "NL_female", "FR_male", "FR_female")
1484908740888:program_data <- map(
1484908740889:vec_all_programs,
1484908740890:~{ getCampaignDataForCustomer(customer, ., refetch = refetch)}
1484908740890:) %>% rbindlist()
1484908740891:}
1484909157377:unique_contactlist <- unique(program_data[, .(segment, contact_id)])
1484909158277:first_contactlist <- getListOfFirstSTOReceivers(program_data)
1484909159144:last_contactlist <- getListOfLastSTOReceivers(program_data)
1484909160224:stable_contactlist <- merge(first_contactlist, last_contactlist, by = c('contact_id', 'segment'))
1484909172636:contactlist <- first_contactlist
1484909179969:all_data <- addPastData(customer, program, program_data, contactlist, refetch = FALSE) %>%
1484909179970:merge(contactlist, by = c('contact_id', 'segment'))
1484909395475:program <- 'FR_male'
1484909401596:program <- 'FR_female'
1484909404097:refetch <- TRUE
1484909404824:program_data <- getCampaignDataForCustomer(customer, program, refetch = refetch)
1484909496815:unique_contactlist <- unique(program_data[, .(segment, contact_id)])
1484909497432:first_contactlist <- getListOfFirstSTOReceivers(program_data)
1484909497843:last_contactlist <- getListOfLastSTOReceivers(program_data)
1484909498622:stable_contactlist <- merge(first_contactlist, last_contactlist, by = c('contact_id', 'segment'))
1484909499725:contactlist <- first_contactlist
1484909500121:all_data <- addPastData(customer, program, program_data, contactlist, refetch = FALSE) %>%
1484909500122:merge(contactlist, by = c('contact_id', 'segment'))
1484909622222:all_data %>% .[, .(number_of_emails = .N), by = .(send_day, period, segment)] %>%
1484909622223:plotEvolution(measure = 'number_of_emails', se = FALSE)
1484909636966:all_data %>% getRecipientShareForContactlist(contactlist) %>%
1484909636968:plotEvolution(measure = 'recipient_share', se = FALSE)
1484909650781:all_data %>% getRecipientShareForContactlist(contactlist, unique = TRUE) %>%
1484909650782:plotEvolution(measure = 'recipient_share', se = FALSE)
1484909666308:if (FALSE) {
1484909666309:segments <- unique(all_data[, segment]) %>%
1484909666310:ifelse('control' %in% ., c(., 'both'), .)
1484909666311:pw_common_contacts <- sapply(
1484909666311:c('sto', 'control', 'both'),
1484909666312:function(s) {
1484909666313:getCommonContactMatrix(all_data[period == 'sto'], s, order_by_weekday = F)
1484909666314:},
1484909666314:simplify = FALSE
1484909666315:)
1484909666315:plotHeatmapOfCommonContacts(pw_common_contacts$sto)
1484909666316:plotHeatmapOfCommonContacts(pw_common_contacts$control)
1484909666317:plotHeatmapOfCommonContacts(pw_common_contacts$both)
1484909666317:}
1484909670488:plotSendTimeDistributionEvolution(all_data[period == 'sto' & segment == 'sto'])
1484909686564:plotSendTimeDistributionEvolution(program_data)
1484909693319:plotSendTimeDistributionEvolution(program_data, position = 'fill')
1484909704184:campaign_summary <- calculateCampaignSummary(all_data)
1484909706369:if (customer == 'luisaviaroma') {
1484909706370:campaign_summary <- calculateCampaignSummary(all_data, campaign_condition = 'n > 5000')
1484909706371:}
1484909709343:measure <- 'open_rate'
1484909716524:campaign_summary %>%
1484909716524:smoothMeasureWithWindow(measure, window_size = 1) %>%
1484909716525:plotEvolution(measure = measure) +
1484909716525:scale_y_continuous(labels = scales::percent_format())
1484909727331:campaign_summary %>%
1484909727331:smoothMeasureWithWindow(measure, window_size = 1) %>%
1484909727332:plotEvolution(measure = measure, smooth = TRUE) +
1484909727332:scale_y_continuous(labels = scales::percent_format())
1484909746911:generateRelativeData(campaign_summary, measure = measure) %>%
1484909746911:plotRelativeEvolution(trendlines = F, measure = measure, sto_text = FALSE, facet = group_by)
1484910002238:reportStatistics(
1484910002238:customer, program_data,
1484910002239:unique_contacts, common_contacts,
1484910002239:check_pairwise_common = FALSE
1484910002240:)
1484910073539:View(unique_contacts)
1484910085251:rm("unique_contacts")
1484910097294:rm("common_contacts")
1484910105583:unique_contactlist <- unique(program_data[, .(segment, contact_id)])
1484910106056:n_campaigns <- program_data[segment == 'sto', uniqueN(campaign_id)]
1484910106490:common_contactlist <- program_data[, .N, by = .(segment, contact_id)] %>%
1484910106490:.[N == n_campaigns, .(segment, contact_id)]
1484910107075:reportStatistics(
1484910107076:customer, program_data,
1484910107077:unique_contactlist, common_contactlist,
1484910107077:check_pairwise_common = FALSE
1484910107077:)
1484910156788:contactlist <- common_contactlist
1484910161771:all_data <- addPastData(customer, program, program_data, contactlist, refetch = FALSE) %>%
1484910161772:merge(contactlist, by = c('contact_id', 'segment'))
1484910222116:campaign_summary <- calculateCampaignSummary(all_data)
1484910227263:measure <- 'open_rate'
1484910230856:campaign_summary %>%
1484910230856:smoothMeasureWithWindow(measure, window_size = 1) %>%
1484910230857:plotEvolution(measure = measure) +
1484910230857:scale_y_continuous(labels = scales::percent_format())
1484910242192:generateRelativeData(campaign_summary, measure = measure) %>%
1484910242192:plotRelativeEvolution(trendlines = F, measure = measure, sto_text = FALSE, facet = group_by)
1484910285496:all_data %>% .[, .(number_of_emails = .N), by = .(send_day, period, segment)] %>%
1484910285496:plotEvolution(measure = 'number_of_emails', se = FALSE)
1484910290832:all_data %>% getRecipientShareForContactlist(contactlist) %>%
1484910290833:plotEvolution(measure = 'recipient_share', se = FALSE)
1484910293506:all_data %>% getRecipientShareForContactlist(contactlist, unique = TRUE) %>%
1484910293507:plotEvolution(measure = 'recipient_share', se = FALSE)
1484910308312:measure <- 'click_rate'
1484910314755:generateRelativeData(campaign_summary, measure = measure) %>%
1484910314755:plotRelativeEvolution(trendlines = F, measure = measure, sto_text = FALSE, facet = group_by)
1484910345004:calculateMedianDistance(all_data) %>% plotMedianHoursToOpen(prior_change_dates = FALSE)
1484910358564:calculateMedianDistance(all_data) %>%
1484910358564:generateRelativeData(measure = 'median_hours_to_open') %>%
1484910358565:plotRelativeEvolution(trendlines = F, measure = 'median send-open distance (hours)', color = 'weekday')
1484910421109:calculateMedianDistance(all_data) %>%
1484910421111:generateRelativeData(measure = 'median_hours_to_open') %>%
1484910421111:plotRelativeEvolution(trendlines = F, measure = 'median send-open distance (hours)')
1484914765984:customer <- 'lesara'
1484914766448:program <- 'NL_female'
1484914772210:refetch <- F
1484914772786:program_data <- getCampaignDataForCustomer(customer, program, refetch = refetch)
1484914778349:unique_contactlist <- unique(program_data[, .(segment, contact_id)])
1484914778763:n_campaigns <- program_data[segment == 'sto', uniqueN(campaign_id)]
1484914779124:common_contactlist <- program_data[, .N, by = .(segment, contact_id)] %>%
1484914779124:.[N == n_campaigns, .(segment, contact_id)]
1484914779530:reportStatistics(
1484914779531:customer, program_data,
1484914779532:unique_contactlist, common_contactlist,
1484914779532:check_pairwise_common = FALSE
1484914779532:)
1484914781520:first_contactlist <- getListOfFirstSTOReceivers(program_data)
1484914781797:last_contactlist <- getListOfLastSTOReceivers(program_data)
1484914782116:stable_contactlist <- merge(first_contactlist, last_contactlist, by = c('contact_id', 'segment'))
1484914783632:contactlist <- common_contactlist
1484914789402:contactlist <- first_contactlist
1484914792439:all_data <- addPastData(customer, program, program_data, contactlist, refetch = FALSE) %>%
1484914792439:merge(contactlist, by = c('contact_id', 'segment'))
1484914956007:all_data %>% .[, .(number_of_emails = .N), by = .(send_day, period, segment)] %>%
1484914956008:plotEvolution(measure = 'number_of_emails', se = FALSE)
1484914962731:all_data %>% getRecipientShareForContactlist(contactlist, unique = TRUE) %>%
1484914962731:plotEvolution(measure = 'recipient_share', se = FALSE)
1484914977252:campaign_summary <- calculateCampaignSummary(all_data)
1484914983752:generateRelativeData(campaign_summary, measure = measure) %>%
1484914983753:plotRelativeEvolution(trendlines = F, measure = measure, sto_text = FALSE, facet = group_by)
1484915164896:campaign_summary
1484915173735:all_data[, mean(bounced)]
1484915184808:all_data[, mean(bounced), by= segment]
1484915191211:all_data[period == 'sto', mean(bounced), by= segment]
1484915215436:calculateActivitySummary <- function(dt, by, initial_n_hours = Inf) {
1484915215436:dt[bounced == FALSE
1484915215437:,
1484915215438:.(
1484915215438:open_rate = mean(opened & hours_to_open <= initial_n_hours),
1484915215438:open_rate_sd = sd(opened & hours_to_open <= initial_n_hours),
1484915215439:num_open = sum(opened & hours_to_open <= initial_n_hours),
1484915215439:click_rate = mean(clicked & hours_to_click <= initial_n_hours),
1484915215439:click_rate_sd = sd(clicked & hours_to_click <= initial_n_hours),
1484915215440:num_click = sum(clicked & hours_to_open <= initial_n_hours),
1484915215440:click_to_open_rate = sum(clicked & hours_to_click <= initial_n_hours)/sum(opened & hours_to_open <= initial_n_hours),
1484915215441:n = .N
1484915215441:),
1484915215441:by = by
1484915215442:]
1484915215442:}
1484915224353:campaign_summary <- calculateCampaignSummary(all_data)
1484915228995:campaign_summary
1484915230643:campaign_summary
1484915279076:first_contactlist
1484915288875:first_contactlist[, .N, by = segment]
1484915399196:all_data
1484915408863:all_data
1484915421025:all_data[, uniqueN(contact_id), by = segment]
1484915424106:first_contactlist[, .N, by = segment]
1484915527969:campaign_summary %>%
1484915527969:merge(all_data[, .(n_in_segment = uniqueN(contact_id)), by = segment], by = 'segment') %>%
1484915527970:generateRelativeData(measure = num_open / n_in_segment)
1484916044211:campaign_summary
1484916051630:calculateActivitySummary <- function(dt, by, initial_n_hours = Inf) {
1484916051630:contacts_in_segments <- dt[, .(n_in_segment = uniqueN(contact_id)), by = segment]
1484916051631:num_columns <- c('num_open', 'num_click')
1484916051632:dt[bounced == FALSE
1484916051632:,
1484916051633:.(
1484916051634:open_rate = mean(opened & hours_to_open <= initial_n_hours),
1484916051635:open_rate_sd = sd(opened & hours_to_open <= initial_n_hours),
1484916051635:num_open = sum(opened & hours_to_open <= initial_n_hours),
1484916051636:click_rate = mean(clicked & hours_to_click <= initial_n_hours),
1484916051638:click_rate_sd = sd(clicked & hours_to_click <= initial_n_hours),
1484916051639:num_click = sum(clicked & hours_to_open <= initial_n_hours),
1484916051641:click_to_open_rate = sum(clicked & hours_to_click <= initial_n_hours)/sum(opened & hours_to_open <= initial_n_hours),
1484916051642:n = .N
1484916051644:),
1484916051645:by = by
1484916051646:] %>%
1484916051647:merge(contacts_in_segments, by = 'segment') %>%
1484916051648:.[, (num_columns) := lapply(.SD/n_in_segment), .SDcols = num_columns]
1484916051649:}
1484916059782:calculateCampaignSummary <- function(campaign_data, initial_n_hours = Inf, contact_condition = 'TRUE', campaign_condition = 'TRUE', base_by = c('period', 'segment', 'send_day'), additional_by = NULL) {
1484916059783:by <- c(base_by, additional_by)
1484916059784:campaign_data %>%
1484916059785:.[eval(parse(text = contact_condition))] %>%
1484916059786:calculateActivitySummary(by = by, initial_n_hours = initial_n_hours) %>%
1484916059787:.[eval(parse(text = campaign_condition))] %>%
1484916059789:addWeekdayToDt_() %>%
1484916059790:addWeekendToSummary_()
1484916059791:}
1484916065772:campaign_summary <- calculateCampaignSummary(all_data)
1484916114007:calculateActivitySummary <- function(dt, by, initial_n_hours = Inf) {
1484916114008:contacts_in_segments <- dt[, .(n_in_segment = uniqueN(contact_id)), by = segment]
1484916114010:num_columns <- c('num_open', 'num_click')
1484916114011:dt[bounced == FALSE
1484916114011:,
1484916114012:.(
1484916114013:open_rate = mean(opened & hours_to_open <= initial_n_hours),
1484916114014:open_rate_sd = sd(opened & hours_to_open <= initial_n_hours),
1484916114014:num_open = sum(opened & hours_to_open <= initial_n_hours),
1484916114015:click_rate = mean(clicked & hours_to_click <= initial_n_hours),
1484916114016:click_rate_sd = sd(clicked & hours_to_click <= initial_n_hours),
1484916114016:num_click = sum(clicked & hours_to_open <= initial_n_hours),
1484916114017:click_to_open_rate = sum(clicked & hours_to_click <= initial_n_hours)/sum(opened & hours_to_open <= initial_n_hours),
1484916114018:n = .N
1484916114019:),
1484916114020:by = by
1484916114021:] %>%
1484916114023:merge(contacts_in_segments, by = 'segment') %>%
1484916114024:.[, (num_columns) := lapply(.SD, function(x) x/n_in_segment), .SDcols = num_columns]
1484916114026:}
1484916118357:campaign_summary <- calculateCampaignSummary(all_data)
1484916123832:campaign_summary
1484916124968:campaign_summary
1484916383947:campaign_summary %>%
1484916390192:measure <- 'num_open'
1484916390605:campaign_summary %>%
1484916391081:generateRelativeData(measure = measure) %>%
1484916391571:plotRelativeEvolution(trendlines = F, measure = measure, sto_text = FALSE, facet = group_by)
1484916429643:all_data
1484916606737:customer <- 'lesara'
1484916606738:program <- 'FR_female'
1484916606739:# collect data ----------------------------------------------------------------
1484916606739:refetch <- F
1484916607704:program_data <- getCampaignDataForCustomer(customer, program, refetch = refetch)
1484916610167:unique_contactlist <- unique(program_data[, .(segment, contact_id)])
1484916610573:n_campaigns <- program_data[segment == 'sto', uniqueN(campaign_id)]
1484916610871:common_contactlist <- program_data[, .N, by = .(segment, contact_id)] %>%
1484916611216:.[N == n_campaigns, .(segment, contact_id)]
1484916612008:reportStatistics(
1484916613321:customer, program_data,
1484916613781:unique_contactlist, common_contactlist,
1484916614073:check_pairwise_common = FALSE
1484916614439:)
1484916844326:first_contactlist <- getListOfFirstSTOReceivers(program_data)
1484916849986:contactlist <- first_contactlist
1484916853345:all_data <- addPastData(customer, program, program_data, contactlist, refetch = FALSE) %>%
1484916853946:merge(contactlist, by = c('contact_id', 'segment'))
1484916861828:n_past_campaigns <- all_data[period == 'past', .N, by = .(segment, contact_id)]
1484916863512:n_past_campaigns %>% ggplot(aes(x = N)) +
1484916863959:geom_histogram(binwidth = 5) +
1484916864470:scale_x_continuous(breaks = seq(0,90,5))
1484916877386:n_past_campaigns[N == 0]
1484916888077:n_past_campaigns[, .N, by = N]
1484916891447:n_past_campaigns[, .N, keyby = N]
1484917261674:past_campaign_num_limit <- 10
1484917262589:all_data <- merge(
1484917262590:all_data,
1484917262592:n_past_campaigns[N >= past_campaign_num_limit, .(contact_id, segment)],
1484917262592:by = c('contact_id', 'segment')
1484917262593:)
1484917279984:reportStatistics(
1484917279985:customer, program_data,
1484917279985:unique_contactlist, common_contactlist,
1484917279986:check_pairwise_common = FALSE
1484917279986:)
1484917334492:past_campaign_num_limit <- 10
1484917336781:all_data <- merge(
1484917336782:all_data,
1484917336783:n_past_campaigns[N >= past_campaign_num_limit, .(contact_id, segment)],
1484917336783:by = c('contact_id', 'segment')
1484917336783:)
1484917340124:all_data
1484917363612:all_data[, uniqueN(contact_id), by = segment]
1484917379762:all_data[, uniqueN(contact_id), by = .(campaign_id, segment)]
1484917390861:all_data[period == 'sto', uniqueN(contact_id), by = .(campaign_id, segment)]
1484917406215:all_data %>% .[, .(number_of_emails = .N), by = .(send_day, period, segment)] %>%
1484917406216:plotEvolution(measure = 'number_of_emails', se = FALSE)
1484917416689:campaign_summary <- calculateCampaignSummary(all_data)
1484917419830:measure <- 'open_rate'
1484917432572:generateRelativeData(campaign_summary, measure = measure) %>%
1484917432572:plotRelativeEvolution(trendlines = F, measure = measure, sto_text = FALSE, facet = group_by)
1484917463335:measure <- 'num_open'
1484917464018:campaign_summary %>%
1484917464691:generateRelativeData(measure = measure) %>%
1484917465924:plotRelativeEvolution(trendlines = F, measure = measure, sto_text = FALSE, facet = group_by)
1484917545427:customer <- 'lesara'
1484917545842:program <- 'FR_male'
1484917547449:refetch <- F
1484917548746:program_data <- getCampaignDataForCustomer(customer, program, refetch = refetch)
1484917550838:unique_contactlist <- unique(program_data[, .(segment, contact_id)])
1484917551185:n_campaigns <- program_data[segment == 'sto', uniqueN(campaign_id)]
1484917551495:common_contactlist <- program_data[, .N, by = .(segment, contact_id)] %>%
1484917552273:.[N == n_campaigns, .(segment, contact_id)]
1484917553241:reportStatistics(
1484917553974:customer, program_data,
1484917554347:unique_contactlist, common_contactlist,
1484917554639:check_pairwise_common = FALSE
1484917554909:)
1484917556892:first_contactlist <- getListOfFirstSTOReceivers(program_data)
1484917559376:contactlist <- first_contactlist
1484917561374:all_data <- addPastData(customer, program, program_data, contactlist, refetch = FALSE) %>%
1484917562977:merge(contactlist, by = c('contact_id', 'segment'))
1484919689481:n_past_campaigns <- all_data[period == 'past', .N, by = .(segment, contact_id)]
1484919691055:past_campaign_num_limit <- 10
1484919692448:all_data <- merge(
1484919692916:all_data,
1484919693194:n_past_campaigns[N >= past_campaign_num_limit, .(contact_id, segment)],
1484919693542:by = c('contact_id', 'segment')
1484919693944:)
1484919708977:all_data %>% .[, .(number_of_emails = .N), by = .(send_day, period, segment)] %>%
1484919708978:plotEvolution(measure = 'number_of_emails', se = FALSE)
1484919714076:all_data %>% getRecipientShareForContactlist(contactlist) %>%
1484919715731:plotEvolution(measure = 'recipient_share', se = FALSE)
1484919721156:all_data %>% getRecipientShareForContactlist(contactlist, unique = TRUE) %>%
1484919722598:plotEvolution(measure = 'recipient_share', se = FALSE)
1484919730831:plotSendTimeDistributionEvolution(all_data[period == 'sto' & segment == 'sto'])
1484919736693:campaign_summary <- calculateCampaignSummary(all_data)
1484919746717:measure <- 'open_rate'
1484919747684:campaign_summary %>%
1484919748731:smoothMeasureWithWindow(measure, window_size = 1) %>%
1484919751393:plotEvolution(measure = measure) +
1484919751853:scale_y_continuous(labels = scales::percent_format())
1484919759167:measure <- 'open_rate'
1484919763272:generateRelativeData(campaign_summary, measure = measure) %>%
1484919763744:plotRelativeEvolution(trendlines = F, measure = measure, sto_text = FALSE, facet = group_by)
1484919789078:measure <- 'num_open'
1484919789460:campaign_summary %>%
1484919789776:generateRelativeData(measure = measure) %>%
1484919790071:plotRelativeEvolution(trendlines = F, measure = measure, sto_text = FALSE, facet = group_by)
1484919824908:plotRelativeEvolution <- function(relative_data, measure = 'open_rate', time_var = 'send_day', color = NULL, facet = NULL, cols = NULL, trendlines = TRUE, prior_change_dates = TRUE, sto_line = TRUE, sto_text = TRUE, text_position = 0.8, offset = 2) {
1484919824909:p <- relative_data[send_day < Sys.Date() - offset] %>%
1484919824910:ggplot(aes_string(x = time_var, y = 'relative_measure')) +
1484919824911:geom_hline(yintercept = 1, linetype = 'dashed')
1484919824912:if (is.null(color)) {
1484919824913:p <- p +
1484919824914:geom_line(col = "#40877E") +
1484919824914:geom_point(fill = "#40877E", colour = 'white', size = 3, pch = 21)
1484919824916:} else {
1484919824918:p <- p +
1484919824920:geom_point(aes_string(color = color)) +
1484919824922:geom_line(aes_string(color = color))
1484919824924:}
1484919824925:if (trendlines) {
1484919824926:p <- p + geom_smooth(aes(group = send_day < relative_data[period == 'past', max(send_day)]), method = 'lm', col = "#40877E", size = 0.5, se = F)
1484919824927:}
1484919824928:if (!is.null(facet)) {
1484919824929:p <- p + facet_wrap(as.formula(paste('~', facet)), ncol = cols, scales = 'free_x')
1484919824930:}
1484919824932:p + addSTOline(
1484919824934:start_date = relative_data[period == 'past', max(send_day)],
1484919824935:sto_line, sto_text, prior_change_dates, text_position
1484919824937:) +
1484919824938:labs(x = time_var, y = str_c('relative', str_replace_all(measure, '_', ' '), sep = ' ')) +
1484919824940:scale_color_discrete(guide = guide_legend(nrow = 1)) +
1484919824942:theme(legend.position = 'bottom') +
1484919824943:theme_bw()
1484919824945:}
1484919829878:campaign_summary %>%
1484919832733:generateRelativeData(measure = measure) %>%
1484919834820:plotRelativeEvolution(trendlines = F, measure = measure, sto_text = FALSE, facet = group_by)
1484919853145:plotRelativeEvolution <- function(relative_data, measure = 'open_rate', time_var = 'send_day', color = NULL, facet = NULL, cols = NULL, trendlines = TRUE, prior_change_dates = TRUE, sto_line = TRUE, sto_text = TRUE, text_position = 0.8, offset = 2) {
1484919853146:p <- relative_data[send_day < Sys.Date() - offset] %>%
1484919853147:ggplot(aes_string(x = time_var, y = 'relative_measure')) +
1484919853147:geom_hline(yintercept = 1, linetype = 'dashed')
1484919853148:if (is.null(color)) {
1484919853148:p <- p +
1484919853149:geom_line(col = "#40877E") +
1484919853149:geom_point(fill = "#40877E", colour = 'white', size = 3, pch = 21)
1484919853150:} else {
1484919853151:p <- p +
1484919853151:geom_point(aes_string(color = color)) +
1484919853152:geom_line(aes_string(color = color))
1484919853152:}
1484919853153:if (trendlines) {
1484919853155:p <- p + geom_smooth(aes(group = send_day < relative_data[period == 'past', max(send_day)]), method = 'lm', col = "#40877E", size = 0.5, se = F)
1484919853156:}
1484919853156:if (!is.null(facet)) {
1484919853157:p <- p + facet_wrap(as.formula(paste('~', facet)), ncol = cols, scales = 'free_x')
1484919853157:}
1484919853158:p + addSTOline(
1484919853159:start_date = relative_data[period == 'past', max(send_day)],
1484919853159:sto_line, sto_text, prior_change_dates, text_position
1484919853160:) +
1484919853160:labs(x = time_var, y = str_c('relative', str_replace_all(measure, '_', ' '), sep = ' ')) +
1484919853161:scale_color_discrete(guide = guide_legend(nrow = 1)) +
1484919853161:theme(legend.position = 'bottom', text = element_text(family = 'Canaro Medium')) +
1484919853162:theme_bw()
1484919853163:}
1484919858163:measure <- 'num_open'
1484919858164:campaign_summary %>%
1484919858165:generateRelativeData(measure = measure) %>%
1484919858165:plotRelativeEvolution(trendlines = F, measure = measure, sto_text = FALSE, facet = group_by)
1484919868161:plotRelativeEvolution <- function(relative_data, measure = 'open_rate', time_var = 'send_day', color = NULL, facet = NULL, cols = NULL, trendlines = TRUE, prior_change_dates = TRUE, sto_line = TRUE, sto_text = TRUE, text_position = 0.8, offset = 2) {
1484919868162:p <- relative_data[send_day < Sys.Date() - offset] %>%
1484919868162:ggplot(aes_string(x = time_var, y = 'relative_measure')) +
1484919868163:geom_hline(yintercept = 1, linetype = 'dashed')
1484919868164:if (is.null(color)) {
1484919868164:p <- p +
1484919868165:geom_line(col = "#40877E") +
1484919868165:geom_point(fill = "#40877E", colour = 'white', size = 3, pch = 21)
1484919868166:} else {
1484919868167:p <- p +
1484919868169:geom_point(aes_string(color = color)) +
1484919868170:geom_line(aes_string(color = color))
1484919868172:}
1484919868174:if (trendlines) {
1484919868175:p <- p + geom_smooth(aes(group = send_day < relative_data[period == 'past', max(send_day)]), method = 'lm', col = "#40877E", size = 0.5, se = F)
1484919868177:}
1484919868177:if (!is.null(facet)) {
1484919868178:p <- p + facet_wrap(as.formula(paste('~', facet)), ncol = cols, scales = 'free_x')
1484919868179:}
1484919868180:p + addSTOline(
1484919868180:start_date = relative_data[period == 'past', max(send_day)],
1484919868181:sto_line, sto_text, prior_change_dates, text_position
1484919868182:) +
1484919868183:labs(x = time_var, y = str_c('relative', str_replace_all(measure, '_', ' '), sep = ' ')) +
1484919868185:scale_color_discrete(guide = guide_legend(nrow = 1)) +
1484919868186:theme(legend.position = 'bottom', text = element_text(family = 'Canaro Medium')) +
1484919868186:theme_bw()
1484919868187:}
1484919870644:measure <- 'num_open'
1484919870645:campaign_summary %>%
1484919870646:generateRelativeData(measure = measure) %>%
1484919870646:plotRelativeEvolution(trendlines = F, measure = measure, sto_text = FALSE, facet = group_by)
1484919912608:plotRelativeEvolution <- function(relative_data, measure = 'open_rate', time_var = 'send_day', color = NULL, facet = NULL, cols = NULL, trendlines = TRUE, prior_change_dates = TRUE, sto_line = TRUE, sto_text = TRUE, text_position = 0.8, offset = 2) {
1484919912609:p <- relative_data[send_day < Sys.Date() - offset] %>%
1484919912610:ggplot(aes_string(x = time_var, y = 'relative_measure')) +
1484919912611:geom_hline(yintercept = 1, linetype = 'dashed')
1484919912611:if (is.null(color)) {
1484919912612:p <- p +
1484919912613:geom_line(col = "#40877E") +
1484919912613:geom_point(fill = "#40877E", colour = 'white', size = 3, pch = 21)
1484919912614:} else {
1484919912615:p <- p +
1484919912615:geom_point(aes_string(color = color)) +
1484919912616:geom_line(aes_string(color = color))
1484919912617:}
1484919912618:if (trendlines) {
1484919912618:p <- p + geom_smooth(aes(group = send_day < relative_data[period == 'past', max(send_day)]), method = 'lm', col = "#40877E", size = 0.5, se = F)
1484919912620:}
1484919912622:if (!is.null(facet)) {
1484919912623:p <- p + facet_wrap(as.formula(paste('~', facet)), ncol = cols, scales = 'free_x')
1484919912625:}
1484919912626:p + addSTOline(
1484919912628:start_date = relative_data[period == 'past', max(send_day)],
1484919912629:sto_line, sto_text, prior_change_dates, text_position
1484919912630:) +
1484919912631:labs(x = time_var, y = str_c('relative', str_replace_all(measure, '_', ' '), sep = ' ')) +
1484919912632:scale_color_discrete(guide = guide_legend(nrow = 1)) +
1484919912633:theme(legend.position = 'bottom', text = element_text(family = 'Canaro Medium')) +
1484919912634:theme_bw()
1484919912635:}
1484919922410:measure <- 'num_open'
1484919922411:campaign_summary %>%
1484919922412:generateRelativeData(measure = measure) %>%
1484919922412:plotRelativeEvolution(trendlines = F, measure = measure, sto_text = FALSE, facet = group_by)
1484919939675:measure <- 'num_open'
1484919939676:campaign_summary %>%
1484919939676:generateRelativeData(measure = measure) %>%
1484919939677:plotRelativeEvolution(trendlines = F, measure = measure, sto_text = FALSE, facet = group_by) + theme(text = element_text(family = 'Canaro Medium'))
1484919965997:plotRelativeEvolution <- function(relative_data, measure = 'open_rate', time_var = 'send_day', color = NULL, facet = NULL, cols = NULL, trendlines = TRUE, prior_change_dates = TRUE, sto_line = TRUE, sto_text = TRUE, text_position = 0.8, offset = 2) {
1484919965998:p <- relative_data[send_day < Sys.Date() - offset] %>%
1484919965998:ggplot(aes_string(x = time_var, y = 'relative_measure')) +
1484919965999:geom_hline(yintercept = 1, linetype = 'dashed')
1484919966000:if (is.null(color)) {
1484919966000:p <- p +
1484919966001:geom_line(col = "#40877E") +
1484919966001:geom_point(fill = "#40877E", colour = 'white', size = 3, pch = 21)
1484919966002:} else {
1484919966003:p <- p +
1484919966003:geom_point(aes_string(color = color)) +
1484919966004:geom_line(aes_string(color = color))
1484919966006:}
1484919966007:if (trendlines) {
1484919966009:p <- p + geom_smooth(aes(group = send_day < relative_data[period == 'past', max(send_day)]), method = 'lm', col = "#40877E", size = 0.5, se = F)
1484919966011:}
1484919966012:if (!is.null(facet)) {
1484919966014:p <- p + facet_wrap(as.formula(paste('~', facet)), ncol = cols, scales = 'free_x')
1484919966015:}
1484919966015:p + addSTOline(
1484919966016:start_date = relative_data[period == 'past', max(send_day)],
1484919966017:sto_line, sto_text, prior_change_dates, text_position
1484919966017:) +
1484919966019:labs(x = time_var, y = str_c('relative', str_replace_all(measure, '_', ' '), sep = ' ')) +
1484919966020:scale_color_discrete(guide = guide_legend(nrow = 1)) +
1484919966021:theme_bw() +
1484919966022:theme(legend.position = 'bottom', text = element_text(family = 'Canaro Medium'))
1484919966023:}
1484919975113:measure <- 'num_open'
1484919975114:campaign_summary %>%
1484919975115:generateRelativeData(measure = measure) %>%
1484919975115:plotRelativeEvolution(trendlines = F, measure = measure, sto_text = FALSE, facet = group_by)
1484920086518:customer <- 'lesara'
1484920087050:program <- 'NL_female'
1484920088824:refetch <- F
1484920089915:program_data <- getCampaignDataForCustomer(customer, program, refetch = refetch)
1484920093556:unique_contactlist <- unique(program_data[, .(segment, contact_id)])
1484920093824:n_campaigns <- program_data[segment == 'sto', uniqueN(campaign_id)]
1484920094071:common_contactlist <- program_data[, .N, by = .(segment, contact_id)] %>%
1484920094271:.[N == n_campaigns, .(segment, contact_id)]
1484920094663:reportStatistics(
1484920095107:customer, program_data,
1484920095318:unique_contactlist, common_contactlist,
1484920095517:check_pairwise_common = FALSE
1484920095853:)
1484920101492:# stable contactlist: first & last STO receivers
1484920102019:first_contactlist <- getListOfFirstSTOReceivers(program_data)
1484920105173:last_contactlist <- getListOfLastSTOReceivers(program_data)
1484920105726:stable_contactlist <- merge(first_contactlist, last_contactlist, by = c('contact_id', 'segment'))
1484920106948:contactlist <- first_contactlist
1484920108196:all_data <- addPastData(customer, program, program_data, contactlist, refetch = FALSE) %>%
1484920108589:merge(contactlist, by = c('contact_id', 'segment'))
1484920113376:n_past_campaigns <- all_data[period == 'past', .N, by = .(segment, contact_id)]
1484920113655:past_campaign_num_limit <- 10
1484920114365:all_data <- merge(
1484920114885:all_data,
1484920115107:n_past_campaigns[N >= past_campaign_num_limit, .(contact_id, segment)],
1484920115372:by = c('contact_id', 'segment')
1484920115829:)
1484920116769:saveRDS(all_data, file.path('data', str_c(customer, '_', program, '_all_data.rds')))
1484920140368:customer <- 'lesara'
1484920140735:program <- 'NL_female'
1484920141470:all_data <- readAllData(customer, program)
1484920144292:group_by <- NULL
1484920145583:all_data %>% .[, .(number_of_emails = .N), by = .(send_day, period, segment)] %>%
1484920145984:plotEvolution(measure = 'number_of_emails', se = FALSE)
1484920153084:campaign_summary <- calculateCampaignSummary(all_data)
1484920154574:measure <- 'open_rate'
1484920162519:generateRelativeData(campaign_summary, measure = measure) %>%
1484920162945:plotRelativeEvolution(trendlines = F, measure = measure, sto_text = FALSE, facet = group_by)
1484920197100:campaign_summary
1484920210214:campaign_summary[period == 'sto', n]
1484920218086:campaign_summary[period == 'sto', .(segment, send_day, n)]
1484920235206:measure <- 'num_open'
1484920235638:campaign_summary %>%
1484920236302:generateRelativeData(measure = measure) %>%
1484920236807:plotRelativeEvolution(trendlines = F, measure = measure, sto_text = FALSE, facet = group_by)
1484920553222:customer <- 'lesara'
1484920553685:program <- 'FR_female'
1484920554833:all_data <- readAllData(customer, program)
1484920580836:program <- 'FR_female'
1484920581780:refetch <- F
1484920582539:program_data <- getCampaignDataForCustomer(customer, program, refetch = refetch)
1484920585555:unique_contactlist <- unique(program_data[, .(segment, contact_id)])
1484920585862:n_campaigns <- program_data[segment == 'sto', uniqueN(campaign_id)]
1484920586119:common_contactlist <- program_data[, .N, by = .(segment, contact_id)] %>%
1484920586386:.[N == n_campaigns, .(segment, contact_id)]
1484920586979:reportStatistics(
1484920587360:customer, program_data,
1484920587588:unique_contactlist, common_contactlist,
1484920587806:check_pairwise_common = FALSE
1484920588043:)
1484920588402:# stable contactlist: first & last STO receivers
1484920588621:first_contactlist <- getListOfFirstSTOReceivers(program_data)
1484920588881:last_contactlist <- getListOfLastSTOReceivers(program_data)
1484920589122:stable_contactlist <- merge(first_contactlist, last_contactlist, by = c('contact_id', 'segment'))
1484920589944:####### --> choose contactlist <-- #############################################
1484920590238:contactlist <- first_contactlist
1484920592016:all_data <- addPastData(customer, program, program_data, contactlist, refetch = FALSE) %>%
1484920592242:merge(contactlist, by = c('contact_id', 'segment'))
1484920596184:n_past_campaigns <- all_data[period == 'past', .N, by = .(segment, contact_id)]
1484920596430:past_campaign_num_limit <- 10
1484920596431:all_data <- merge(
1484920596432:all_data,
1484920596846:n_past_campaigns[N >= past_campaign_num_limit, .(contact_id, segment)],
1484920597063:by = c('contact_id', 'segment')
1484920597257:)
1484920597586:saveRDS(all_data, file.path('data', str_c(customer, '_', program, '_all_data.rds')))
1484920613963:generateRelativeData(campaign_summary, measure = measure) %>%
1484920614579:plotRelativeEvolution(trendlines = F, measure = measure, sto_text = FALSE, facet = group_by)
1484920631697:campaign_summary <- calculateCampaignSummary(all_data)
1484920636223:generateRelativeData(campaign_summary, measure = measure) %>%
1484920636538:plotRelativeEvolution(trendlines = F, measure = measure, sto_text = FALSE, facet = group_by)
1484920647168:campaign_summary %>%
1484920647562:generateRelativeData(measure = measure) %>%
1484920647912:plotRelativeEvolution(trendlines = F, measure = measure, sto_text = FALSE, facet = group_by)
1484923958816:myggsave('relative_open_rate')
1484923964402:generateRelativeData(campaign_summary, measure = measure) %>%
1484923964404:plotRelativeEvolution(trendlines = F, measure = measure, sto_text = FALSE, facet = group_by)
1484923967651:myggsave('relative_open_rate')
1484923973486:myggsave('relative_open_rate.png')
1484923992079:program <- 'FR_male'
1484923993505:all_data <- readAllData(customer, program)
1484923999408:refetch <- F
1484923999898:program_data <- getCampaignDataForCustomer(customer, program, refetch = refetch)
1484924009563:unique_contactlist <- unique(program_data[, .(segment, contact_id)])
1484924009823:n_campaigns <- program_data[segment == 'sto', uniqueN(campaign_id)]
1484924010066:common_contactlist <- program_data[, .N, by = .(segment, contact_id)] %>%
1484924010274:.[N == n_campaigns, .(segment, contact_id)]
1484924010717:reportStatistics(
1484924011351:customer, program_data,
1484924011579:unique_contactlist, common_contactlist,
1484924011784:check_pairwise_common = FALSE
1484924011988:)
1484924015132:first_contactlist <- getListOfFirstSTOReceivers(program_data)
1484924015408:last_contactlist <- getListOfLastSTOReceivers(program_data)
1484924015696:stable_contactlist <- merge(first_contactlist, last_contactlist, by = c('contact_id', 'segment'))
1484924016849:####### --> choose contactlist <-- #############################################
1484924017147:contactlist <- first_contactlist
1484924019188:all_data <- addPastData(customer, program, program_data, contactlist, refetch = FALSE) %>%
1484924019607:merge(contactlist, by = c('contact_id', 'segment'))
1484924022283:past_campaign_num_limit <- 10
1484924023605:all_data <- merge(
1484924023879:all_data,
1484924024141:n_past_campaigns[N >= past_campaign_num_limit, .(contact_id, segment)],
1484924024391:by = c('contact_id', 'segment')
1484924024654:)
1484924025811:saveRDS(all_data, file.path('data', str_c(customer, '_', program, '_all_data.rds')))
1484924032147:all_data <- readAllData(customer, program)
1484924038565:campaign_summary <- calculateCampaignSummary(all_data)
1484924041544:generateRelativeData(campaign_summary, measure = measure) %>%
1484924042290:plotRelativeEvolution(trendlines = F, measure = measure, sto_text = FALSE, facet = group_by)
1484924055335:program_data <- getCampaignDataForCustomer(customer, program, refetch = refetch)
1484924060238:program <- 'FR_male'
1484924061701:program_data <- getCampaignDataForCustomer(customer, program, refetch = refetch)
1484924129091:if (customer == 'batiwiz') {
1484924129092:# append new programs
1484924129092:na_program_data <- getCampaignDataForCustomer(customer, 'NA-TD120', refetch = refetch)
1484924129093:a_program_data <- getCampaignDataForCustomer(customer, 'A-TD120', refetch = refetch)
1484924129093:common_dates <- as.Date(
1484924129094:intersect(
1484924129094:unique(a_program_data$send_day),
1484924129095:unique(na_program_data$send_day))
1484924129096:, origin = '1970-01-01'
1484924129096:)
1484924129097:a_filtered <- a_program_data[send_day %in% common_dates]
1484924129098:na_filtered <- na_program_data[send_day %in% common_dates]
1484924129098:program_data <- rbindlist(list(program_data, na_filtered, a_filtered))
1484924129099:}
1484924131030:unique_contactlist <- unique(program_data[, .(segment, contact_id)])
1484924131531:n_campaigns <- program_data[segment == 'sto', uniqueN(campaign_id)]
1484924131857:common_contactlist <- program_data[, .N, by = .(segment, contact_id)] %>%
1484924132180:.[N == n_campaigns, .(segment, contact_id)]
1484924135559:reportStatistics(
1484924136278:customer, program_data,
1484924136631:unique_contactlist, common_contactlist,
1484924136944:check_pairwise_common = FALSE
1484924137220:)
1484924141329:first_contactlist <- getListOfFirstSTOReceivers(program_data)
1484924142652:contactlist <- first_contactlist
1484924146276:all_data <- addPastData(customer, program, program_data, contactlist, refetch = FALSE) %>%
1484924146693:merge(contactlist, by = c('contact_id', 'segment'))
1484924151749:n_past_campaigns <- all_data[period == 'past', .N, by = .(segment, contact_id)]
1484924153415:past_campaign_num_limit <- 10
1484924154374:all_data <- merge(
1484924154746:all_data,
1484924154981:n_past_campaigns[N >= past_campaign_num_limit, .(contact_id, segment)],
1484924155201:by = c('contact_id', 'segment')
1484924155451:)
1484924158742:saveRDS(all_data, file.path('data', str_c(customer, '_', program, '_all_data.rds')))
1484924194667:all_data <- readAllData(customer, program)
1484924199035:campaign_summary <- calculateCampaignSummary(all_data)
1484924201688:measure <- 'open_rate'
1484924203281:campaign_summary %>%
1484924203709:smoothMeasureWithWindow(measure, window_size = 1) %>%
1484924204006:plotEvolution(measure = measure) +
1484924204374:scale_y_continuous(labels = scales::percent_format())
1484924211246:generateRelativeData(campaign_summary, measure = measure) %>%
1484924211744:plotRelativeEvolution(trendlines = F, measure = measure, sto_text = FALSE, facet = group_by)
1484924247268:myggsave(str_c(program, 'relative_open_rate.png', sep = '_')
1484924256704:)
1484924324903:customer <- 'lesara'
1484924325152:program <- 'NL_male'
1484924326271:refetch <- F
1484924326966:program_data <- getCampaignDataForCustomer(customer, program, refetch = refetch)
1484924328804:if (customer == 'batiwiz') {
1484924328805:# append new programs
1484924328806:na_program_data <- getCampaignDataForCustomer(customer, 'NA-TD120', refetch = refetch)
1484924328806:a_program_data <- getCampaignDataForCustomer(customer, 'A-TD120', refetch = refetch)
1484924328807:common_dates <- as.Date(
1484924328807:intersect(
1484924328809:unique(a_program_data$send_day),
1484924328810:unique(na_program_data$send_day))
1484924328811:, origin = '1970-01-01'
1484924328812:)
1484924328813:a_filtered <- a_program_data[send_day %in% common_dates]
1484924328814:na_filtered <- na_program_data[send_day %in% common_dates]
1484924328815:program_data <- rbindlist(list(program_data, na_filtered, a_filtered))
1484924328817:}
1484924330116:unique_contactlist <- unique(program_data[, .(segment, contact_id)])
1484924330554:n_campaigns <- program_data[segment == 'sto', uniqueN(campaign_id)]
1484924330981:common_contactlist <- program_data[, .N, by = .(segment, contact_id)] %>%
1484924331379:.[N == n_campaigns, .(segment, contact_id)]
1484924332120:reportStatistics(
1484924332584:customer, program_data,
1484924332996:unique_contactlist, common_contactlist,
1484924333695:check_pairwise_common = FALSE
1484924334209:)
1484924334497:# stable contactlist: first & last STO receivers
1484924334673:first_contactlist <- getListOfFirstSTOReceivers(program_data)
1484924334882:last_contactlist <- getListOfLastSTOReceivers(program_data)
1484924335117:stable_contactlist <- merge(first_contactlist, last_contactlist, by = c('contact_id', 'segment'))
1484924335350:####### --> choose contactlist <-- #############################################
1484924335516:contactlist <- first_contactlist
1484924335696:################################################################################
1484924336523:all_data <- addPastData(customer, program, program_data, contactlist, refetch = FALSE) %>%
1484924336746:merge(contactlist, by = c('contact_id', 'segment'))
1484924346365:past_campaign_num_limit <- 10
1484924347006:all_data <- merge(
1484924347680:all_data,
1484924347912:n_past_campaigns[N >= past_campaign_num_limit, .(contact_id, segment)],
1484924348128:by = c('contact_id', 'segment')
1484924348335:)
1484924348788:saveRDS(all_data, file.path('data', str_c(customer, '_', program, '_all_data.rds')))
1484924358506:campaign_summary <- calculateCampaignSummary(all_data)
1484924364009:generateRelativeData(campaign_summary, measure = measure) %>%
1484924364466:plotRelativeEvolution(trendlines = F, measure = measure, sto_text = FALSE, facet = group_by)
1484924378077:first_contactlist <- getListOfFirstSTOReceivers(program_data)
1484924379924:last_contactlist <- getListOfLastSTOReceivers(program_data)
1484924382156:stable_contactlist <- merge(first_contactlist, last_contactlist, by = c('contact_id', 'segment'))
1484924387950:contactlist <- first_contactlist
1484924395358:all_data <- addPastData(customer, program, program_data, contactlist, refetch = FALSE) %>%
1484924395864:merge(contactlist, by = c('contact_id', 'segment'))
1484924404424:n_past_campaigns <- all_data[period == 'past', .N, by = .(segment, contact_id)]
1484924406049:past_campaign_num_limit <- 10
1484924407793:all_data <- merge(
1484924408379:all_data,
1484924408867:n_past_campaigns[N >= past_campaign_num_limit, .(contact_id, segment)],
1484924409426:by = c('contact_id', 'segment')
1484924410544:)
1484924414159:saveRDS(all_data, file.path('data', str_c(customer, '_', program, '_all_data.rds')))
1484924426146:campaign_summary <- calculateCampaignSummary(all_data)
1484924432110:generateRelativeData(campaign_summary, measure = measure) %>%
1484924432625:plotRelativeEvolution(trendlines = F, measure = measure, sto_text = FALSE, facet = group_by)
1484924433637:myggsave(str_c(program, 'relative_open_rate.png', sep = '_'))
1484924446589:program <- 'NL_female'
1484924449295:all_data <- readAllData(customer, program)
1484924457379:campaign_summary <- calculateCampaignSummary(all_data)
1484924460955:generateRelativeData(campaign_summary, measure = measure) %>%
1484924461320:plotRelativeEvolution(trendlines = F, measure = measure, sto_text = FALSE, facet = group_by)
1484924670385:myggsave(str_c(program, 'relative_open_rate.png', sep = '_'))
1484924848506:customer <- 'travelist_market'
1484924853994:program <- 'test2'
1484924857302:refetch <- T
1484924858825:program_data <- getCampaignDataForCustomer(customer, program, refetch = refetch)
1484926671362:customer <- 'edigital'
1484926671870:program <- 'test'
1484926677235:all_data <- readAllData(customer, program)
1484926700263:campaign_summary <- calculateCampaignSummary(all_data)
1484926720112:campaign_summary %>%
1484926720580:generateRelativeData(measure = measure) %>%
1484926721147:plotRelativeEvolution(trendlines = F, measure = measure, sto_text = FALSE, facet = group_by)
1484926724319:generateRelativeData(campaign_summary, measure = measure) %>%
1484926724917:plotRelativeEvolution(trendlines = F, measure = measure, sto_text = FALSE, facet = group_by) +
1484926725342:coord_cartesian(ylim = c(0.9, 1.1))
1484926730655:myggsave(str_c(program, 'relative_open_rate.png', sep = '_'))
1484926739931:customer <- 'lingualeo'
1484926740233:program <- 'test'
1484926741025:all_data <- readAllData(customer, program)
1484926751255:campaign_summary <- calculateCampaignSummary(all_data)
1484926758534:generateRelativeData(campaign_summary, measure = measure) %>%
1484926758923:plotRelativeEvolution(trendlines = F, measure = measure, sto_text = FALSE, facet = group_by) +
1484926759363:coord_cartesian(ylim = c(0.9, 1.1))
1484926821288:customer <- 'lesara'
1484926821816:program <- 'NL_female'
1484926823339:all_data <- readAllData(customer, program)
1484926826455:group_by <- NULL
1484926830535:campaign_summary <- calculateCampaignSummary(all_data)
1484926836364:generateRelativeData(campaign_summary, measure = measure) %>%
1484926836774:plotRelativeEvolution(trendlines = F, measure = measure, sto_text = FALSE, facet = group_by) +
1484926837161:coord_cartesian(ylim = c(0.9, 1.1))
1484926839151:myggsave(str_c(program, 'relative_open_rate.png', sep = '_'))
1484926846320:program <- 'NL_male'
1484926847113:all_data <- readAllData(customer, program)
1484926851794:campaign_summary <- calculateCampaignSummary(all_data)
1484926858760:generateRelativeData(campaign_summary, measure = measure) %>%
1484926859109:plotRelativeEvolution(trendlines = F, measure = measure, sto_text = FALSE, facet = group_by) +
1484926859502:coord_cartesian(ylim = c(0.9, 1.1))
1484926861093:myggsave(str_c(program, 'relative_open_rate.png', sep = '_'))
1484926866231:program <- 'FR_male'
1484926867086:all_data <- readAllData(customer, program)
1484926870755:campaign_summary <- calculateCampaignSummary(all_data)
1484926877519:generateRelativeData(campaign_summary, measure = measure) %>%
1484926877857:plotRelativeEvolution(trendlines = F, measure = measure, sto_text = FALSE, facet = group_by) +
1484926878228:coord_cartesian(ylim = c(0.9, 1.1))
1484926881261:myggsave(str_c(program, 'relative_open_rate.png', sep = '_'))
1484926890023:program <- 'FR_female'
1484926891662:all_data <- readAllData(customer, program)
1484926899462:campaign_summary <- calculateCampaignSummary(all_data)
1484926906607:generateRelativeData(campaign_summary, measure = measure) %>%
1484926906990:plotRelativeEvolution(trendlines = F, measure = measure, sto_text = FALSE, facet = group_by) +
1484926907386:coord_cartesian(ylim = c(0.9, 1.1))
1484926909235:myggsave(str_c(program, 'relative_open_rate.png', sep = '_'))
1485259396161:install.packages(c("backports", "chron", "Rcpp", "rprojroot"))
1485259407164:install.packages(c("Matrix", "mgcv", "nlme", "survival"), lib="/Users/jdivenyi/projects/incentive-followup/packrat/lib-R")
1485259444912:packrat::status()
1485259467602:packrat::restore(prompt = FALSE)
1485259598339:install.packages('Matrix')
1485259641154:packrat::status()
1485259661534:packrat::restore(prompt = FALSE)
1485259685808:install.packages('bigrquery')
1485259698176:install.packages('nlme')
1485259712439:packrat::status()
1485259749693:packrat::restore()
1485259830686:install.packages('devtools')
1485259837597:devtools::install_github('rstats-db/bigrquery')
1485259854534:install.packages('mgcv')
1485259864656:packrat::restore()
1485259901482:packrat::status()
1485259911520:packrat::restore()
1485260024694:packrat::restore()
1485260035630:.myfuncs$useEmarsysCRAN()
1485260050121:install.packages('emsconnectr', type = 'source')
1485260061823:packrat::restore()
1485260072337:install.packages('Matrix')
1485260080882:packrat::status()
1485260088682:packrat::restore()
1485260098769:packrat::snapshot()
1485260125186:packrat::snapshot(ignore.stale = TRUE)
1485260151004:packrat::status()
1485260164731:packrat::snapshot()
1485260199494:packrat::snapshot()
1485260269121:packrat::status()
1485260533079:packrat::restore(prompt = FALSE)
1485269663983:source('global.R')
1485269674506:customer <- 'lesara'
1485269674908:program <- 'FR_female'
1485269676926:refetch <- T
1485269679046:program_data <- getCampaignDataForCustomer(customer, program, refetch = refetch)
1485269710896:program_data <- getCampaignDataForCustomer(customer, program, refetch = refetch)
1485269770462:sessionInfo()
1485269819893:program_data <- getCampaignDataForCustomer(customer, program, refetch = refetch)
1485269916062:program_data <- getCampaignDataForCustomer(customer, program, refetch = refetch)
1485269940133:source('global.R')
1485269941370:customer <- 'lesara'
1485269941371:program <- 'FR_female'
1485269943583:refetch <- T
1485269944058:program_data <- getCampaignDataForCustomer(customer, program, refetch = refetch)
1485270029185:program_data <- getCampaignDataForCustomer(customer, program, refetch = refetch)
1485270048727:refetch <- T
1485270048738:program_data <- getCampaignDataForCustomer(customer, program, refetch = refetch)
1485270051471:source('global.R')
1485270054158:customer <- 'lesara'
1485270054660:program <- 'FR_female'
1485270055746:refetch <- T
1485270057196:program_data <- getCampaignDataForCustomer(customer, program, refetch = refetch)
1485270692968:source('global.R')
1485270694422:customer <- 'lesara'
1485270694894:program <- 'FR_female'
1485270696242:all_data <- readAllData(customer, program)
1485270698870:group_by <- NULL
1485270705852:reportStatistics(all_data)
1485270712425:reportStatistics(all_data, customer, program)
1485270818629:group_by <- NULL
1485270819701:all_data %>% .[, .(number_of_emails = .N), by = .(send_day, period, segment)] %>%
1485270819701:plotEvolution(measure = 'number_of_emails', se = FALSE)
1485270820375:all_data %>% getRecipientShareForContactlist(contactlist) %>%
1485270820376:plotEvolution(measure = 'recipient_share', se = FALSE)
1485270879255:plotSendTimeDistributionEvolution(all_data[period == 'sto' & segment == 'sto'])
1485270883676:campaign_summary <- calculateCampaignSummary(all_data)
1485270886598:measure <- 'open_rate'
1485270887603:campaign_summary %>%
1485270887603:smoothMeasureWithWindow(measure, window_size = 1) %>%
1485270887604:plotEvolution(measure = measure) +
1485270887605:scale_y_continuous(labels = scales::percent_format())
1485270895790:generateRelativeData(campaign_summary, measure = measure) %>%
1485270895790:plotRelativeEvolution(
1485270895791:trendlines = F, measure = measure, color = group_by, text_position = 0.9
1485270895791:) +
1485270895792:coord_cartesian(ylim = c(0.9, 1.2))
1485270909832:generateRelativeData(campaign_summary, measure = measure) %>%
1485270909833:plotRelativeEvolution(trendlines = F, measure = measure, sto_text = FALSE, facet = group_by)
